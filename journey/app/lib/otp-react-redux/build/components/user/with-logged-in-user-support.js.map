{"version":3,"sources":["with-logged-in-user-support.js"],"names":["withLoggedInUserSupport","WrappedComponent","requireLoggedInUser","props","UserLoaderScreen","Component","componentDidUpdate","auth","fetchOrInitializeUser","loggedInUser","accessToken","render","children","isAuthenticated","mapStateToProps","state","ownProps","user","mapDispatchToProps","userActions","UserLoaderScreenWithAuth","audience","AUTH0_AUDIENCE","scope","AUTH0_SCOPE"],"mappings":";;;;;;;;;AAAA;;AACA;;AACA;;AAEA;;AACA;;AACA;;AACA;;;;;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACe,SAASA,uBAAT,CAAkCC,gBAAlC,EAAoDC,mBAApD,EAAyE;AACtF,SAAOC,KAAK,iBACV,6BAAC,wBAAD;AAA0B,IAAA,mBAAmB,EAAED;AAA/C,kBACE,6BAAC,gBAAD,EAAsBC,KAAtB,CADF,CADF;AAKD;AAED;AACA;AACA;AACA;AACA;;;AACA,MAAMC,gBAAN,SAA+BC,gBAA/B,CAAyC;AACvCC,EAAAA,kBAAkB,GAAI;AACpB,UAAM;AAAEC,MAAAA,IAAF;AAAQC,MAAAA,qBAAR;AAA+BC,MAAAA;AAA/B,QAAgD,KAAKN,KAA3D,CADoB,CAGpB;;AACA,QAAII,IAAI,IAAIA,IAAI,CAACG,WAAb,IAA4B,CAACD,YAAjC,EAA+C;AAC7CD,MAAAA,qBAAqB,CAACD,IAAD,CAArB;AACD;AACF;;AAEDI,EAAAA,MAAM,GAAI;AACR,UAAM;AAAEJ,MAAAA,IAAF;AAAQK,MAAAA,QAAR;AAAkBH,MAAAA,YAAlB;AAAgCP,MAAAA;AAAhC,QAAwD,KAAKC,KAAnE;;AAEA,QAAII,IAAJ,EAAU;AACR,UAAIL,mBAAmB,IAAIK,IAAI,CAACM,eAA5B,IAA+C,CAACJ,YAApD,EAAkE;AAChE;AACA;AACA;AACA,4BAAO,6BAAC,uBAAD,OAAP;AACD,OALD,MAKO;AACL,eAAO,iCAAwBG,QAAxB,EAAkC;AAAEL,UAAAA;AAAF,SAAlC,CAAP;AACD;AACF;;AAED,WAAOK,QAAP;AACD;;AAzBsC,C,CA4BzC;;;AAEA,MAAME,eAAe,GAAG,CAACC,KAAD,EAAQC,QAAR,KAAqB;AAC3C,SAAO;AACLP,IAAAA,YAAY,EAAEM,KAAK,CAACE,IAAN,CAAWR;AADpB,GAAP;AAGD,CAJD;;AAMA,MAAMS,kBAAkB,GAAG;AACzBV,EAAAA,qBAAqB,EAAEW,WAAW,CAACX;AADV,CAA3B;AAIA,MAAMY,wBAAwB,GAAG,6BAC/B,yBAAQN,eAAR,EAAyBI,kBAAzB,EAA6Cd,gBAA7C,CAD+B,EAE/B;AACEiB,EAAAA,QAAQ,EAAEC,yBADZ;AAEEC,EAAAA,KAAK,EAAEC;AAFT,CAF+B,CAAjC","sourcesContent":["import React, { Component } from 'react'\nimport { connect } from 'react-redux'\nimport { withAuth } from 'use-auth0-hooks'\n\nimport * as userActions from '../../actions/user'\nimport { AUTH0_AUDIENCE, AUTH0_SCOPE } from '../../util/constants'\nimport { renderChildrenWithProps } from '../../util/ui'\nimport AwaitingScreen from './awaiting-screen'\n\n/**\n * This higher-order component ensures that state.user is loaded\n * in the redux store for any wrapped component that may need it.\n * The requireLoggedInUser argument handles the two use cases for this component:\n * - Some components (e.g. those processing a user account) require a logged in user to be available,\n *   and without it they cannot function.\n     For such components, set requireLoggedInUser to true.\n *   An awaiting screen will be displayed while state.user data are being fetched,\n *   and the wrapped component will be shown upon availability of state.user.\n * - Other components (e.g. landing pages) don't require a logged in user to be available to function\n *   but will display extra functionality if so.\n *   For such components, omit requireLoggedInUser parameter (or set to false).\n *   The wrapped component is shown immediately, and no awaiting screen is displayed while state.user is being retrieved.\n * @param {React.Component} WrappedComponent The component to be wrapped to that uses state.user from the redux store.\n * @param {boolean} requireLoggedInUser Whether the wrapped component requires state.user to properly function.\n */\nexport default function withLoggedInUserSupport (WrappedComponent, requireLoggedInUser) {\n  return props => (\n    <UserLoaderScreenWithAuth requireLoggedInUser={requireLoggedInUser}>\n      <WrappedComponent {...props} />\n    </UserLoaderScreenWithAuth>\n  )\n}\n\n/**\n * This component ensures that values under state.user are set when a user is logged in.\n * If needed by the children, this component displays a wait screen while state.user values are being fetched.\n * Upon completion (or if no user is logged in or if auth is disabled), it renders children.\n */\nclass UserLoaderScreen extends Component {\n  componentDidUpdate () {\n    const { auth, fetchOrInitializeUser, loggedInUser } = this.props\n\n    // Once accessToken is available, proceed to fetch or initialize loggedInUser.\n    if (auth && auth.accessToken && !loggedInUser) {\n      fetchOrInitializeUser(auth)\n    }\n  }\n\n  render () {\n    const { auth, children, loggedInUser, requireLoggedInUser } = this.props\n\n    if (auth) {\n      if (requireLoggedInUser && auth.isAuthenticated && !loggedInUser) {\n        // Display a hint while fetching user data for logged in user (from componentDidMount).\n        // Don't display this if loggedInUser is already available.\n        // TODO: Improve this screen.\n        return <AwaitingScreen />\n      } else {\n        return renderChildrenWithProps(children, { auth })\n      }\n    }\n\n    return children\n  }\n}\n\n// connect to the redux store\n\nconst mapStateToProps = (state, ownProps) => {\n  return {\n    loggedInUser: state.user.loggedInUser\n  }\n}\n\nconst mapDispatchToProps = {\n  fetchOrInitializeUser: userActions.fetchOrInitializeUser\n}\n\nconst UserLoaderScreenWithAuth = withAuth(\n  connect(mapStateToProps, mapDispatchToProps)(UserLoaderScreen),\n  {\n    audience: AUTH0_AUDIENCE,\n    scope: AUTH0_SCOPE\n  }\n)\n"]}