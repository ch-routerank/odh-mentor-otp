{"version":3,"sources":["stylized-map.js"],"names":["STYLES","places","display","place","getId","coreUtils","map","isBikeshareStation","fill","stroke","r","stops_merged","data","index","utils","StylizedMap","Component","componentDidMount","el","document","getElementById","_transitive","Transitive","styles","gridCellSize","zoomFactors","minScale","internalVertexFactor","angleConstraint","mergeVertexThreshold","render","call","scaleExtent","on","setTransform","event","transform","componentDidUpdate","prevProps","transitiveData","props","updateData","routingType","activeItinerary","focusJourney","journeys","journey_id","position","top","bottom","left","right","PropTypes","number","string","toggleLabel","element","object","toggleName","mapStateToProps","state","ownProps","activeSearch","otp","query","response","plan","itins","visibleItinerary","itineraryToTransitive","mapDispatchToProps"],"mappings":"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","sourcesContent":["import { select, event } from 'd3-selection'\nimport { zoom } from 'd3-zoom'\nimport coreUtils from '@opentripplanner/core-utils'\nimport PropTypes from 'prop-types'\nimport React, { Component } from 'react'\nimport { connect } from 'react-redux'\nimport Transitive from 'transitive-js'\n\nimport { getActiveSearch, getActiveItineraries } from '../../util/state'\n\nvar STYLES = {}\n\nSTYLES.places = {\n  display: function (display, place) {\n    if (\n      place.getId() !== 'from' &&\n      place.getId() !== 'to' &&\n      !coreUtils.map.isBikeshareStation(place)\n    ) {\n      return 'none'\n    }\n  },\n  fill: '#fff',\n  stroke: '#000',\n  'stroke-width': 2,\n  r: 8\n}\n\nSTYLES.stops_merged = {\n  r: function (display, data, index, utils) {\n    return 6\n  }\n}\n\nclass StylizedMap extends Component {\n  static propTypes = {\n    activeItinerary: PropTypes.number,\n    routingType: PropTypes.string,\n    toggleLabel: PropTypes.element,\n    transitiveData: PropTypes.object\n  }\n\n  static defaultProps = {\n    toggleName: 'Stylized'\n  }\n\n  componentDidMount () {\n    const el = document.getElementById('trn-canvas')\n    this._transitive = new Transitive({\n      el,\n      display: 'svg',\n      styles: STYLES,\n      gridCellSize: 200,\n      zoomFactors: [\n        {\n          minScale: 0,\n          gridCellSize: 300,\n          internalVertexFactor: 1000000,\n          angleConstraint: 45,\n          mergeVertexThreshold: 200\n        }\n      ]\n    })\n    this._transitive.render()\n\n    select(el).call(zoom()\n      .scaleExtent([1 / 2, 4])\n      .on('zoom', () => {\n        this._transitive.setTransform(event.transform)\n      })\n    )\n  }\n\n  componentDidUpdate (prevProps) {\n    if (prevProps.transitiveData !== this.props.transitiveData) {\n      this._transitive.updateData(this.props.transitiveData, true)\n      this._transitive.render()\n    }\n\n    if ( // this block only applies for profile trips where active option changed\n      this.props.routingType === 'PROFILE' &&\n      prevProps.activeItinerary !== this.props.activeItinerary\n    ) {\n      if (this.props.activeItinerary == null) {\n        // no option selected; clear focus\n        this._transitive.focusJourney(null)\n        this._transitive.render()\n      } else if (this.props.transitiveData) {\n        this._transitive.focusJourney(\n          this.props.transitiveData.journeys[this.props.activeItinerary]\n            .journey_id\n        )\n        this._transitive.render()\n      }\n    }\n  }\n\n  render () {\n    return (\n      <div\n        id='trn-canvas'\n        style={{ position: 'absolute', top: 0, bottom: 0, left: 0, right: 0 }}\n      />\n    )\n  }\n}\n\n// connect to the redux store\nconst mapStateToProps = (state, ownProps) => {\n  const activeSearch = getActiveSearch(state.otp)\n  let transitiveData = null\n  if (\n    activeSearch &&\n    activeSearch.query.routingType === 'ITINERARY' &&\n    activeSearch.response &&\n    activeSearch.response.plan\n  ) {\n    const itins = getActiveItineraries(state.otp)\n    const visibleItinerary = itins[activeSearch.activeItinerary]\n    if (visibleItinerary) transitiveData = coreUtils.map.itineraryToTransitive(visibleItinerary)\n  } else if (\n    activeSearch &&\n    activeSearch.response &&\n    activeSearch.response.otp\n  ) {\n    transitiveData = activeSearch.response.otp\n  }\n\n  return {\n    transitiveData,\n    activeItinerary: activeSearch && activeSearch.activeItinerary,\n    routingType: activeSearch && activeSearch.query && activeSearch.query.routingType\n  }\n}\n\nconst mapDispatchToProps = {}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(StylizedMap)\n"]}