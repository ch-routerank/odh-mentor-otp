{"version":3,"sources":["default-itinerary.js"],"names":["isBicycle","isTransit","coreUtils","itinerary","formatDuration","formatTime","time","getItineraryDescription","primaryTransitDuration","mainMode","transitMode","legs","forEach","leg","i","duration","mode","rentedBike","toLowerCase","description","ITINERARY_ATTRIBUTES","alias","id","order","render","options","isSelected","selection","endTime","startTime","LegIcon","walkTime","width","height","display","paddingLeft","paddingBottom","DefaultItinerary","NarrativeItinerary","active","index","setVisibleItinerary","visibleItinerary","props","visibleNotSet","undefined","isVisible","attribute","sort","type","expanded","showRealtimeAnnotation","timeFormat","timeOptions","format","offset","getTimeZoneOffset","borderLeft","backgroundColor","_onMouseEnter","_onMouseLeave","_onHeaderClick","a","b","aSelected","_isSortingOnAttribute","bSelected","map","clear","textAlign","color"],"mappings":"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","sourcesContent":["import coreUtils from '../../../otp-ui/core-utils/src'\nimport React from 'react'\n\nimport NarrativeItinerary from '../narrative-itinerary'\nimport ItineraryBody from '../line-itin/connected-itinerary-body'\nimport ItinerarySummary from './itinerary-summary'\nimport SimpleRealtimeAnnotation from '../simple-realtime-annotation'\nimport { getTotalFareAsString } from '../../../util/state'\n\nconst { isBicycle, isTransit } = coreUtils.itinerary\nconst { formatDuration, formatTime } = coreUtils.time\n\n// FIXME move to core utils\nfunction getItineraryDescription (itinerary) {\n  let primaryTransitDuration = 0\n  let mainMode = 'Walk'\n  let transitMode\n  itinerary.legs.forEach((leg, i) => {\n    const {duration, mode, rentedBike} = leg\n    if (isTransit(mode) && duration > primaryTransitDuration) {\n      // TODO: convert OTP's TRAM mode to the correct wording for Portland\n      primaryTransitDuration = duration\n      transitMode = mode.toLowerCase()\n    }\n    if (isBicycle(mode)) mainMode = 'Bike'\n    if (rentedBike) mainMode = 'Bikeshare'\n    if (mode === 'CAR') mainMode = 'Drive'\n  })\n  let description = mainMode\n  if (transitMode) description += ` $_to_$ ${transitMode}`\n  return description\n}\n\nconst ITINERARY_ATTRIBUTES = [\n  {\n    alias: 'best',\n    id: 'duration',\n    order: 0,\n    render: (itinerary, options) => formatDuration(itinerary.duration)\n  },\n  {\n    alias: 'departureTime',\n    id: 'arrivalTime',\n    order: 1,\n    render: (itinerary, options) => {\n      if (options.isSelected) {\n        if (options.selection === 'ARRIVALTIME') return formatTime(itinerary.endTime, options)\n        else return formatTime(itinerary.startTime, options)\n      }\n      return (\n        <span>\n          {formatTime(itinerary.startTime, options)}\n          â€”\n          {formatTime(itinerary.endTime, options)}\n        </span>\n      )\n    }\n  },\n  {\n    id: 'cost',\n    order: 2,\n    render: (itinerary, options) => getTotalFareAsString(itinerary)\n  },\n  {\n    id: 'walkTime',\n    order: 3,\n    render: (itinerary, options) => {\n      const leg = itinerary.legs[0]\n      const {LegIcon} = options\n      return (\n        // FIXME: For CAR mode, walk time considers driving time.\n        <span>\n          {formatDuration(itinerary.walkTime)}{' '}\n          <div style={{\n            width: '20px',\n            height: '20px',\n            display: 'inline-block',\n            paddingLeft: '2px',\n            paddingBottom: '6px'\n          }}>\n            <LegIcon leg={leg} size={5} />\n          </div>\n        </span>\n      )\n    }\n  }\n]\n\nexport default class DefaultItinerary extends NarrativeItinerary {\n  _onMouseEnter = () => {\n    const {active, index, setVisibleItinerary, visibleItinerary} = this.props\n    // Set this itinerary as visible if not already visible.\n    const visibleNotSet = visibleItinerary === null || visibleItinerary === undefined\n    const isVisible = visibleItinerary === index ||\n      (active === index && visibleNotSet)\n    if (typeof setVisibleItinerary === 'function' && !isVisible) {\n      setVisibleItinerary({index})\n    }\n  }\n\n  _onMouseLeave = () => {\n    const {index, setVisibleItinerary, visibleItinerary} = this.props\n    if (typeof setVisibleItinerary === 'function' && visibleItinerary === index) {\n      setVisibleItinerary({index: null})\n    }\n  }\n\n  _isSortingOnAttribute = (attribute) => {\n    const {sort} = this.props\n    if (sort && sort.type) {\n      const type = sort.type.toLowerCase()\n      return attribute.id.toLowerCase() === type ||\n        (attribute.alias && attribute.alias.toLowerCase() === type)\n    }\n    return false\n  }\n\n  render () {\n    const {\n      active,\n      expanded,\n      itinerary,\n      LegIcon,\n      showRealtimeAnnotation,\n      timeFormat\n    } = this.props\n    const timeOptions = {\n      format: timeFormat,\n      offset: coreUtils.itinerary.getTimeZoneOffset(itinerary)\n    }\n    return (\n      <div\n        className={`option default-itin${active ? ' active' : ''}${expanded ? ' expanded' : ''}`}\n        role='presentation'\n        // FIXME: Move style to css\n        style={{\n          borderLeft: active && !expanded ? '4px teal solid' : undefined,\n          backgroundColor: expanded ? 'white' : undefined\n        }}\n        onMouseEnter={this._onMouseEnter}\n        onMouseLeave={this._onMouseLeave}\n      >\n        <button\n          className='header'\n          // _onHeaderClick comes from super component (NarrativeItinerary).\n          onClick={this._onHeaderClick}\n        >\n          <div\n            className='title'>\n            {getItineraryDescription(itinerary)}\n          </div>\n          <ul className='list-unstyled itinerary-attributes'>\n            {ITINERARY_ATTRIBUTES\n              .sort((a, b) => {\n                const aSelected = this._isSortingOnAttribute(a)\n                const bSelected = this._isSortingOnAttribute(b)\n                if (aSelected) return -1\n                if (bSelected) return 1\n                else return a.order - b.order\n              })\n              .map(attribute => {\n                const isSelected = this._isSortingOnAttribute(attribute)\n                const options = attribute.id === 'arrivalTime' ? timeOptions : {}\n                if (isSelected) {\n                  options.isSelected = true\n                  options.selection = this.props.sort.type\n                }\n                options.LegIcon = LegIcon\n                return (\n                  <li key={attribute.id} className={`${attribute.id}${isSelected ? ' main' : ''}`}>\n                    {attribute.render(itinerary, options)}\n                  </li>\n                )\n              })\n            }\n          </ul>\n          <ItinerarySummary itinerary={itinerary} LegIcon={LegIcon} />\n          {(active && !expanded) &&\n            <small style={{clear: 'both', textAlign: 'center', display: 'block', color: 'grey'}}>\n              click to view details\n            </small>\n          }\n        </button>\n        {(active && expanded) &&\n          <>\n            {showRealtimeAnnotation && <SimpleRealtimeAnnotation />}\n            <ItineraryBody timeOptions={timeOptions} itinerary={itinerary} LegIcon={LegIcon} />\n          </>\n        }\n      </div>\n    )\n  }\n}\n"]}