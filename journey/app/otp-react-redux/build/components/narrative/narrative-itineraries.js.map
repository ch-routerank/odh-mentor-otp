{"version":3,"sources":["narrative-itineraries.js"],"names":["humanReadableMode","modeStr","arr","toLowerCase","replace","split","length","last","pop","join","NarrativeItineraries","setState","showDetails","state","window","confirm","evt","props","sort","updateItineraryFilter","value","target","filter","type","direction","e","setUseRealtimeResponse","useRealtime","itineraries","modes","pending","count","combinations","Array","from","v","i","activeItinerary","activeSearch","containerStyle","errors","itineraryClass","persistence","realtimeEffects","itineraryIsExpanded","undefined","showRealtimeAnnotation","isAffectedByRealtimeData","exceedsThreshold","routesDiffer","resultText","display","justifyContent","flexGrow","_toggleDetailedItinerary","enabled","whiteSpace","overflow","textOverflow","_onFilterChange","_onSortDirChange","marginRight","_onSortChange","overflowY","map","itinerary","index","active","React","createElement","key","routingType","expanded","onClick","mode","requestParameters","error","msg","_renderLoadingDivs","Component","PropTypes","array","func","number","setActiveItinerary","setActiveLeg","setActiveStep","bool","DefaultItinerary","mapStateToProps","ownProps","otp","config","Boolean","activeLeg","activeStep","timeFormat","coreUtils","time","getTimeFormat","visibleItinerary","mapDispatchToProps","dispatch","payload","leg","step","setVisibleItinerary"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;AAEA;;AAQA;;AACA;;AACA;;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAOA;AACA,SAASA,iBAAT,CAA4BC,OAA5B,EAAqC;AACnC,MAAI,CAACA,OAAL,EAAc,OAAO,KAAP;AACd,MAAMC,GAAG,GAAGD,OAAO,CAACE,WAAR,GAAsBC,OAAtB,CAA8B,IAA9B,EAAoC,GAApC,EAAyCC,KAAzC,CAA+C,GAA/C,CAAZ;;AACA,MAAIH,GAAG,CAACI,MAAJ,GAAa,CAAjB,EAAoB;AAClB,QAAMC,IAAI,GAAGL,GAAG,CAACM,GAAJ,EAAb;AACA,WAAON,GAAG,CAACO,IAAJ,CAAS,IAAT,IAAiB,OAAjB,GAA2BF,IAAlC;AACD,GAHD,MAGO;AACL,WAAOL,GAAG,CAACO,IAAJ,CAAS,OAAT,CAAP;AACD;AACF;;IAEKC,oB;;;;;;;;;;;;;;;;4DAiBI,E;;+EAEmB,YAAM;AAC/B,YAAKC,QAAL,CAAc;AAACC,QAAAA,WAAW,EAAE,CAAC,MAAKC,KAAL,CAAWD;AAA1B,OAAd;AACD,K;;gEAEW,YAAM;AAChB;AACAE,MAAAA,MAAM,CAACC,OAAP,CAAe,0CAAf;AACD,K;;sEAEiB,UAAAC,GAAG,EAAI;AAAA,wBACe,MAAKC,KADpB;AAAA,UAChBC,IADgB,eAChBA,IADgB;AAAA,UACVC,qBADU,eACVA,qBADU;AAAA,UAEhBC,KAFgB,GAEPJ,GAAG,CAACK,MAFG,CAEhBD,KAFgB;AAGvBD,MAAAA,qBAAqB,CAAC;AAACG,QAAAA,MAAM,EAAEF,KAAT;AAAgBF,QAAAA,IAAI,EAAJA;AAAhB,OAAD,CAArB;AACD,K;;oEAEe,UAAAF,GAAG,EAAI;AAAA,UACPO,IADO,GACCP,GAAG,CAACK,MADL,CACdD,KADc;AAAA,yBAEyB,MAAKH,KAF9B;AAAA,UAEdK,MAFc,gBAEdA,MAFc;AAAA,UAENJ,IAFM,gBAENA,IAFM;AAAA,UAEAC,qBAFA,gBAEAA,qBAFA;AAGrBA,MAAAA,qBAAqB,CAAC;AAACG,QAAAA,MAAM,EAANA,MAAD;AAASJ,QAAAA,IAAI,kCAAMA,IAAN;AAAYK,UAAAA,IAAI,EAAJA;AAAZ;AAAb,OAAD,CAArB;AACD,K;;uEAEkB,YAAM;AAAA,yBACuB,MAAKN,KAD5B;AAAA,UAChBK,MADgB,gBAChBA,MADgB;AAAA,UACRJ,IADQ,gBACRA,IADQ;AAAA,UACFC,qBADE,gBACFA,qBADE;AAEvB,UAAMK,SAAS,GAAGN,IAAI,CAACM,SAAL,KAAmB,KAAnB,GAA2B,MAA3B,GAAoC,KAAtD;AACAL,MAAAA,qBAAqB,CAAC;AAACG,QAAAA,MAAM,EAANA,MAAD;AAASJ,QAAAA,IAAI,kCAAMA,IAAN;AAAYM,UAAAA,SAAS,EAATA;AAAZ;AAAb,OAAD,CAArB;AACD,K;;oFAE+B,UAACC,CAAD,EAAO;AAAA,yBACS,MAAKR,KADd;AAAA,UAC9BS,sBAD8B,gBAC9BA,sBAD8B;AAAA,UACNC,WADM,gBACNA,WADM;AAErCD,MAAAA,sBAAsB,CAAC;AAACC,QAAAA,WAAW,EAAE,CAACA;AAAf,OAAD,CAAtB;AACD,K;;yEAEoB,YAAM;AAAA,yBACa,MAAKV,KADlB;AAAA,UAClBW,WADkB,gBAClBA,WADkB;AAAA,UACLC,KADK,gBACLA,KADK;AAAA,UACEC,OADF,gBACEA,OADF;AAEzB,UAAI,CAACA,OAAL,EAAc,OAAO,IAAP,CAFW,CAGzB;;AACA,UAAMC,KAAK,GAAGF,KAAK,CAACG,YAAN,GACVH,KAAK,CAACG,YAAN,CAAmB1B,MAAnB,GAA4BsB,WAAW,CAACtB,MAD9B,GAEV,CAFJ;AAGA,aAAO2B,KAAK,CAACC,IAAN,CACL;AAAC5B,QAAAA,MAAM,EAAEyB;AAAT,OADK,EAEL,UAACI,CAAD,EAAIC,CAAJ;AAAA,4BACE;AAAK,UAAA,GAAG,EAAEA,CAAV;AAAa,UAAA,SAAS,EAAC;AAAvB,wBACE,6BAAC,mCAAD;AAAe,UAAA,KAAK,EAAC,MAArB;AAA4B,UAAA,cAAc,EAAC;AAA3C,wBACE,6BAAC,6BAAD;AAAU,UAAA,KAAK,EAAE;AAAjB,UADF,CADF,CADF;AAAA,OAFK,CAAP;AASD,K;;;;;;;6BAES;AAAA;;AAAA,yBAcJ,KAAKnB,KAdD;AAAA,UAENoB,eAFM,gBAENA,eAFM;AAAA,UAGNC,YAHM,gBAGNA,YAHM;AAAA,UAINC,cAJM,gBAINA,cAJM;AAAA,UAKNC,MALM,gBAKNA,MALM;AAAA,UAMNlB,MANM,gBAMNA,MANM;AAAA,UAONM,WAPM,gBAONA,WAPM;AAAA,UAQNa,cARM,gBAQNA,cARM;AAAA,UASNX,OATM,gBASNA,OATM;AAAA,UAUNY,WAVM,gBAUNA,WAVM;AAAA,UAWNC,eAXM,gBAWNA,eAXM;AAAA,UAYNzB,IAZM,gBAYNA,IAZM;AAAA,UAaNS,WAbM,gBAaNA,WAbM;AAeR,UAAI,CAACW,YAAL,EAAmB,OAAO,IAAP;AACnB,UAAMM,mBAAmB,GAAGP,eAAe,KAAKQ,SAApB,IAAiCR,eAAe,KAAK,IAArD,IAA6D,KAAKxB,KAAL,CAAWD,WAApG;AACA,UAAMkC,sBAAsB,GAAGH,eAAe,CAACI,wBAAhB,KAC7BJ,eAAe,CAACK,gBAAhB,IACAL,eAAe,CAACM,YADhB,IAEA,CAACtB,WAH4B,CAA/B;AAKA,UAAMuB,UAAU,GAAGpB,OAAO,GACtB,yBADsB,aAEnBF,WAAW,CAACtB,MAFO,wBAA1B;AAGA,0BACE;AAAK,QAAA,SAAS,EAAC,mBAAf;AAAmC,QAAA,KAAK,EAAEiC;AAA1C,sBACE;AACE,QAAA,SAAS,EAAC,gBADZ;AAEE,QAAA,KAAK,EAAE;AACLY,UAAAA,OAAO,EAAE,MADJ;AAELC,UAAAA,cAAc,EAAE,eAFX;AAGLC,UAAAA,QAAQ,EAAE;AAHL;AAFT,SAQGT,mBAAmB,gBAChB,yEACA;AACE,QAAA,SAAS,EAAC,yBADZ;AAEE,QAAA,OAAO,EAAE,KAAKU;AAFhB,sBAGE;AAAG,QAAA,SAAS,EAAC;AAAb,QAHF,sBADA,EAOCZ,WAAW,IAAIA,WAAW,CAACa,OAA3B,gBACG,6BAAC,mBAAD;AACA,QAAA,cAAc,EAAC,QADf;AAEA,QAAA,SAAS,EAAC,yBAFV;AAGA,QAAA,EAAE,EAAC;AAHH,sBAKA;AAAG,QAAA,SAAS,EAAC;AAAb,QALA,eADH,GAQG,IAfJ,CADgB,gBAmBhB,yEACA;AACE,QAAA,KAAK,EAAEL,UADT;AAEE,QAAA,KAAK,EAAE;AACLM,UAAAA,UAAU,EAAE,QADP;AAELC,UAAAA,QAAQ,EAAE,QAFL;AAGLC,UAAAA,YAAY,EAAE;AAHT;AAFT,SAOGR,UAPH,CADA;AAAA;AAUE;AACA;AACE,QAAA,QAAQ,EAAE,KAAKS,eADjB;AAEE,QAAA,KAAK,EAAErC;AAFT,sBAIE;AAAQ,QAAA,KAAK,EAAC;AAAd,qBAJF,eAKE;AAAQ,QAAA,KAAK,EAAC;AAAd,wBALF,eAME;AAAQ,QAAA,KAAK,EAAC;AAAd,uBANF,eAOE;AAAQ,QAAA,KAAK,EAAC;AAAd,oBAPF,CAXF,eAqBA;AAAK,QAAA,KAAK,EAAE;AAAC6B,UAAAA,OAAO,EAAE;AAAV,SAAZ;AAAkC,QAAA,SAAS,EAAC;AAA5C,sBACE;AACE,QAAA,OAAO,EAAE,KAAKS,gBADhB;AACkC,QAAA,SAAS,EAAC,yBAD5C;AAEE,QAAA,KAAK,EAAE;AAACC,UAAAA,WAAW,EAAE;AAAd;AAFT,sBAGE;AAAG,QAAA,SAAS,8BAAuB3C,IAAI,CAACM,SAAL,CAAerB,WAAf,EAAvB;AAAZ,QAHF,CADF,eAME;AAAQ,QAAA,QAAQ,EAAE,KAAK2D,aAAvB;AAAsC,QAAA,KAAK,EAAE5C,IAAI,CAACE;AAAlD,sBACE;AAAQ,QAAA,KAAK,EAAC;AAAd,uBADF,eAEE;AAAQ,QAAA,KAAK,EAAC;AAAd,oBAFF,eAGE;AAAQ,QAAA,KAAK,EAAC;AAAd,wBAHF,eAIE;AAAQ,QAAA,KAAK,EAAC;AAAd,0BAJF,eAKE;AAAQ,QAAA,KAAK,EAAC;AAAd,qBALF,eAME;AAAQ,QAAA,KAAK,EAAC;AAAd,gBANF,CANF,CArBA,CA3BN,CADF,eAmEE;AACE;AACA,QAAA,SAAS,EAAC,MAFZ;AAGE,QAAA,KAAK,EAAE;AACLiC,UAAAA,QAAQ,EAAE,GADL;AAELU,UAAAA,SAAS,EAAE;AAFN;AAHT,SAQGnC,WAAW,CAACoC,GAAZ,CAAgB,UAACC,SAAD,EAAYC,KAAZ,EAAsB;AACrC,YAAMC,MAAM,GAAGD,KAAK,KAAK7B,eAAzB,CADqC,CAErC;;AACA,YAAI,CAAC8B,MAAD,IAAWvB,mBAAf,EAAoC,OAAO,IAAP;AACpC,4BAAOwB,eAAMC,aAAN,CAAoB5B,cAApB;AACLwB,UAAAA,SAAS,EAATA,SADK;AAELC,UAAAA,KAAK,EAALA,KAFK;AAGLI,UAAAA,GAAG,EAAEJ,KAHA;AAILC,UAAAA,MAAM,EAANA,MAJK;AAKLI,UAAAA,WAAW,EAAE,WALR;AAMLrD,UAAAA,IAAI,EAAJA,IANK;AAOLsD,UAAAA,QAAQ,EAAE,MAAI,CAAC3D,KAAL,CAAWD,WAPhB;AAQL6D,UAAAA,OAAO,EAAEN,MAAM,GAAG,MAAI,CAACb,wBAAR,GAAmCT,SAR7C;AASLC,UAAAA,sBAAsB,EAAtBA;AATK,WAUF,MAAI,CAAC7B,KAVH,EAAP;AAYD,OAhBA,CARH,EA0BGuB,MAAM,CAACwB,GAAP,CAAW,UAACvC,CAAD,EAAIW,CAAJ,EAAU;AACpB,YAAMsC,IAAI,GAAG1E,iBAAiB,CAACyB,CAAC,CAACkD,iBAAF,CAAoBD,IAArB,CAA9B;AACA,4BACE;AAAK,UAAA,GAAG,EAAEtC,CAAV;AAAa,UAAA,SAAS,EAAC;AAAvB,wBACE,sDACE,6BAAC,aAAD;AAAM,UAAA,SAAS,EAAC,cAAhB;AAA+B,UAAA,IAAI,EAAC;AAApC,UADF,EACgE,GADhE,wBAEqBsC,IAFrB,CADF,eAKE,0CAAMjD,CAAC,CAACmD,KAAF,CAAQC,GAAd,CALF,CADF;AASD,OAXA,CA1BH,EAsCG,KAAKC,kBAAL,EAtCH,CAnEF,CADF;AA8GD;;;;EA5MgCC,gB,GA+MnC;;;gBA/MMrE,oB,eACe;AACjBkB,EAAAA,WAAW,EAAEoD,mBAAUC,KADN;AAEjBxC,EAAAA,cAAc,EAAEuC,mBAAUE,IAFT;AAGjBpD,EAAAA,OAAO,EAAEkD,mBAAUG,MAHF;AAIjB9C,EAAAA,eAAe,EAAE2C,mBAAUG,MAJV;AAKjBC,EAAAA,kBAAkB,EAAEJ,mBAAUE,IALb;AAMjBG,EAAAA,YAAY,EAAEL,mBAAUE,IANP;AAOjBI,EAAAA,aAAa,EAAEN,mBAAUE,IAPR;AAQjBxD,EAAAA,sBAAsB,EAAEsD,mBAAUE,IARjB;AASjBvD,EAAAA,WAAW,EAAEqD,mBAAUO;AATN,C;;gBADf7E,oB,kBAakB;AACpB+B,EAAAA,cAAc,EAAE+C;AADI,C;;AAoMxB,IAAMC,eAAe,GAAG,SAAlBA,eAAkB,CAAC5E,KAAD,EAAQ6E,QAAR,EAAqB;AAC3C,MAAMpD,YAAY,GAAG,4BAAgBzB,KAAK,CAAC8E,GAAtB,CAArB;AAD2C,MAEpCjD,WAFoC,GAErB7B,KAAK,CAAC8E,GAAN,CAAUC,MAFW,CAEpClD,WAFoC;AAAA,MAGpCb,KAHoC,GAG3BhB,KAAK,CAAC8E,GAAN,CAAUC,MAHiB,CAGpC/D,KAHoC;AAAA,0BAIpBhB,KAAK,CAAC8E,GAAN,CAAUrE,MAJU;AAAA,MAIpCA,MAJoC,qBAIpCA,MAJoC;AAAA,MAI5BJ,IAJ4B,qBAI5BA,IAJ4B;AAK3C,MAAMY,OAAO,GAAGQ,YAAY,GAAGuD,OAAO,CAACvD,YAAY,CAACR,OAAd,CAAV,GAAmC,KAA/D;AACA,MAAMF,WAAW,GAAG,iCAAqBf,KAAK,CAAC8E,GAA3B,CAApB;AACA,MAAMhD,eAAe,GAAG,+BAAmB9B,KAAK,CAAC8E,GAAzB,CAAxB;AACA,MAAMhE,WAAW,GAAGd,KAAK,CAAC8E,GAAN,CAAUhE,WAA9B;AACA,SAAO;AACLW,IAAAA,YAAY,EAAZA,YADK;AAELE,IAAAA,MAAM,EAAE,4BAAgB3B,KAAK,CAAC8E,GAAtB,CAFH;AAGL;AACA/D,IAAAA,WAAW,EAAXA,WAJK;AAKLE,IAAAA,OAAO,EAAPA,OALK;AAMLa,IAAAA,eAAe,EAAfA,eANK;AAOLN,IAAAA,eAAe,EAAEC,YAAY,IAAIA,YAAY,CAACD,eAPzC;AAQLyD,IAAAA,SAAS,EAAExD,YAAY,IAAIA,YAAY,CAACwD,SARnC;AASLC,IAAAA,UAAU,EAAEzD,YAAY,IAAIA,YAAY,CAACyD,UATpC;AAULzE,IAAAA,MAAM,EAANA,MAVK;AAWLO,IAAAA,KAAK,EAALA,KAXK;AAYLa,IAAAA,WAAW,EAAXA,WAZK;AAaLxB,IAAAA,IAAI,EAAJA,IAbK;AAcL8E,IAAAA,UAAU,EAAEC,mBAAUC,IAAV,CAAeC,aAAf,CAA6BtF,KAAK,CAAC8E,GAAN,CAAUC,MAAvC,CAdP;AAeLjE,IAAAA,WAAW,EAAXA,WAfK;AAgBLyE,IAAAA,gBAAgB,EAAE9D,YAAY,IAAIA,YAAY,CAAC8D;AAhB1C,GAAP;AAkBD,CA3BD;;AA6BA,IAAMC,kBAAkB,GAAG,SAArBA,kBAAqB,CAACC,QAAD,EAAWZ,QAAX,EAAwB;AACjD;AACA;AACA;AACA,SAAO;AACLN,IAAAA,kBAAkB,EAAE,4BAAAmB,OAAO;AAAA,aAAID,QAAQ,CAAC,mCAAmBC,OAAnB,CAAD,CAAZ;AAAA,KADtB;AAEL;AACAlB,IAAAA,YAAY,EAAE,sBAACnB,KAAD,EAAQsC,GAAR,EAAgB;AAC5BF,MAAAA,QAAQ,CAAC,6BAAa;AAACpC,QAAAA,KAAK,EAALA,KAAD;AAAQsC,QAAAA,GAAG,EAAHA;AAAR,OAAb,CAAD,CAAR;AACD,KALI;AAML;AACAlB,IAAAA,aAAa,EAAE,uBAACpB,KAAD,EAAQuC,IAAR,EAAiB;AAC9BH,MAAAA,QAAQ,CAAC,8BAAc;AAACpC,QAAAA,KAAK,EAALA,KAAD;AAAQuC,QAAAA,IAAI,EAAJA;AAAR,OAAd,CAAD,CAAR;AACD,KATI;AAUL/E,IAAAA,sBAAsB,EAAE,gCAAA6E,OAAO;AAAA,aAAID,QAAQ,CAAC,uCAAuBC,OAAvB,CAAD,CAAZ;AAAA,KAV1B;AAWLG,IAAAA,mBAAmB,EAAE,6BAAAH,OAAO;AAAA,aAAID,QAAQ,CAAC,oCAAoBC,OAApB,CAAD,CAAZ;AAAA,KAXvB;AAYLpF,IAAAA,qBAAqB,EAAE,+BAAAoF,OAAO;AAAA,aAAID,QAAQ,CAAC,sCAAsBC,OAAtB,CAAD,CAAZ;AAAA;AAZzB,GAAP;AAcD,CAlBD;;eAoBe,yBAAQd,eAAR,EAAyBY,kBAAzB,EACb3F,oBADa,C","sourcesContent":["import coreUtils from '@opentripplanner/core-utils'\nimport React, { Component } from 'react'\nimport PropTypes from 'prop-types'\nimport Skeleton, { SkeletonTheme } from 'react-loading-skeleton'\nimport { connect } from 'react-redux'\n\nimport {\n  setActiveItinerary,\n  setActiveLeg,\n  setActiveStep,\n  setUseRealtimeResponse,\n  setVisibleItinerary,\n  updateItineraryFilter\n} from '../../actions/narrative'\nimport DefaultItinerary from './default/default-itinerary'\nimport Icon from '../narrative/icon'\nimport LinkButton from '../user/link-button'\nimport {\n  getActiveErrors,\n  getActiveItineraries,\n  getActiveSearch,\n  getRealtimeEffects\n} from '../../util/state'\n\n// TODO: move to utils?\nfunction humanReadableMode (modeStr) {\n  if (!modeStr) return 'N/A'\n  const arr = modeStr.toLowerCase().replace(/_/g, ' ').split(',')\n  if (arr.length > 2) {\n    const last = arr.pop()\n    return arr.join(', ') + ' and ' + last\n  } else {\n    return arr.join(' and ')\n  }\n}\n\nclass NarrativeItineraries extends Component {\n  static propTypes = {\n    itineraries: PropTypes.array,\n    itineraryClass: PropTypes.func,\n    pending: PropTypes.number,\n    activeItinerary: PropTypes.number,\n    setActiveItinerary: PropTypes.func,\n    setActiveLeg: PropTypes.func,\n    setActiveStep: PropTypes.func,\n    setUseRealtimeResponse: PropTypes.func,\n    useRealtime: PropTypes.bool\n  }\n\n  static defaultProps = {\n    itineraryClass: DefaultItinerary\n  }\n\n  state = {}\n\n  _toggleDetailedItinerary = () => {\n    this.setState({showDetails: !this.state.showDetails})\n  }\n\n  _saveTrip = () => {\n    // FIXME: Replace with new save-trip functionality.\n    window.confirm('Are you sure you want to save this trip?')\n  }\n\n  _onFilterChange = evt => {\n    const {sort, updateItineraryFilter} = this.props\n    const {value} = evt.target\n    updateItineraryFilter({filter: value, sort})\n  }\n\n  _onSortChange = evt => {\n    const {value: type} = evt.target\n    const {filter, sort, updateItineraryFilter} = this.props\n    updateItineraryFilter({filter, sort: {...sort, type}})\n  }\n\n  _onSortDirChange = () => {\n    const {filter, sort, updateItineraryFilter} = this.props\n    const direction = sort.direction === 'ASC' ? 'DESC' : 'ASC'\n    updateItineraryFilter({filter, sort: {...sort, direction}})\n  }\n\n  _toggleRealtimeItineraryClick = (e) => {\n    const {setUseRealtimeResponse, useRealtime} = this.props\n    setUseRealtimeResponse({useRealtime: !useRealtime})\n  }\n\n  _renderLoadingDivs = () => {\n    const {itineraries, modes, pending} = this.props\n    if (!pending) return null\n    // Construct loading divs as placeholders while all itineraries load.\n    const count = modes.combinations\n      ? modes.combinations.length - itineraries.length\n      : 0\n    return Array.from(\n      {length: count},\n      (v, i) =>\n        <div key={i} className='option default-itin'>\n          <SkeletonTheme color='#ddd' highlightColor='#eee'>\n            <Skeleton count={3} />\n          </SkeletonTheme>\n        </div>\n    )\n  }\n\n  render () {\n    const {\n      activeItinerary,\n      activeSearch,\n      containerStyle,\n      errors,\n      filter,\n      itineraries,\n      itineraryClass,\n      pending,\n      persistence,\n      realtimeEffects,\n      sort,\n      useRealtime\n    } = this.props\n    if (!activeSearch) return null\n    const itineraryIsExpanded = activeItinerary !== undefined && activeItinerary !== null && this.state.showDetails\n    const showRealtimeAnnotation = realtimeEffects.isAffectedByRealtimeData && (\n      realtimeEffects.exceedsThreshold ||\n      realtimeEffects.routesDiffer ||\n      !useRealtime\n    )\n    const resultText = pending\n      ? 'Finding your options...'\n      : `${itineraries.length} itineraries found.`\n    return (\n      <div className='options itinerary' style={containerStyle}>\n        <div\n          className='options header'\n          style={{\n            display: 'flex',\n            justifyContent: 'space-between',\n            flexGrow: '0'\n          }}\n        >\n          {itineraryIsExpanded\n            ? <>\n              <button\n                className='clear-button-formatting'\n                onClick={this._toggleDetailedItinerary}>\n                <i className='fa fa-arrow-left' /> View all options\n              </button>\n              {/* FIXME: only save if meets requirements (e.g., is transit + non-realtime mode) */}\n              {persistence && persistence.enabled\n                ? <LinkButton\n                  componentClass='button'\n                  className='clear-button-formatting'\n                  to='/savetrip'\n                >\n                  <i className='fa fa-plus-circle' /> Save trip\n                </LinkButton>\n                : null\n              }\n            </>\n            : <>\n              <div\n                title={resultText}\n                style={{\n                  whiteSpace: 'nowrap',\n                  overflow: 'hidden',\n                  textOverflow: 'ellipsis'\n                }}>\n                {resultText}\n              </div>\n              { // FIXME: Enable only when ITINERARY/BATCH routing type enabled.\n                <select\n                  onChange={this._onFilterChange}\n                  value={filter}\n                >\n                  <option value='ALL'>All modes</option>\n                  <option value='TRANSIT'>Transit only</option>\n                  <option value='ACTIVE'>Active only</option>\n                  <option value='CAR'>Uses car</option>\n                </select>\n              }\n              <div style={{display: 'inherit'}} className='sort-options'>\n                <button\n                  onClick={this._onSortDirChange} className='clear-button-formatting'\n                  style={{marginRight: '5px'}}>\n                  <i className={`fa fa-sort-amount-${sort.direction.toLowerCase()}`} />\n                </button>\n                <select onChange={this._onSortChange} value={sort.value}>\n                  <option value='BEST'>Best option</option>\n                  <option value='DURATION'>Duration</option>\n                  <option value='ARRIVALTIME'>Arrival time</option>\n                  <option value='DEPARTURETIME'>Departure time</option>\n                  <option value='WALKTIME'>Walk time</option>\n                  <option value='COST'>Cost</option>\n                </select>\n              </div>\n            </>\n          }\n        </div>\n        <div\n          // FIXME: Change to a ul with li children?\n          className='list'\n          style={{\n            flexGrow: '1',\n            overflowY: 'auto'\n          }}\n        >\n          {itineraries.map((itinerary, index) => {\n            const active = index === activeItinerary\n            // Hide non-active itineraries.\n            if (!active && itineraryIsExpanded) return null\n            return React.createElement(itineraryClass, {\n              itinerary,\n              index,\n              key: index,\n              active,\n              routingType: 'ITINERARY',\n              sort,\n              expanded: this.state.showDetails,\n              onClick: active ? this._toggleDetailedItinerary : undefined,\n              showRealtimeAnnotation,\n              ...this.props\n            })\n          })}\n          {/* FIXME: Flesh out error design/move to component? */}\n          {errors.map((e, i) => {\n            const mode = humanReadableMode(e.requestParameters.mode)\n            return (\n              <div key={i} className='option default-itin'>\n                <h4>\n                  <Icon className='text-warning' type='exclamation-triangle' />{' '}\n                  No trip found for {mode}\n                </h4>\n                <div>{e.error.msg}</div>\n              </div>\n            )\n          })}\n          {this._renderLoadingDivs()}\n        </div>\n      </div>\n    )\n  }\n}\n\n// connect to the redux store\n\nconst mapStateToProps = (state, ownProps) => {\n  const activeSearch = getActiveSearch(state.otp)\n  const {persistence} = state.otp.config\n  const {modes} = state.otp.config\n  const {filter, sort} = state.otp.filter\n  const pending = activeSearch ? Boolean(activeSearch.pending) : false\n  const itineraries = getActiveItineraries(state.otp)\n  const realtimeEffects = getRealtimeEffects(state.otp)\n  const useRealtime = state.otp.useRealtime\n  return {\n    activeSearch,\n    errors: getActiveErrors(state.otp),\n    // swap out realtime itineraries with non-realtime depending on boolean\n    itineraries,\n    pending,\n    realtimeEffects,\n    activeItinerary: activeSearch && activeSearch.activeItinerary,\n    activeLeg: activeSearch && activeSearch.activeLeg,\n    activeStep: activeSearch && activeSearch.activeStep,\n    filter,\n    modes,\n    persistence,\n    sort,\n    timeFormat: coreUtils.time.getTimeFormat(state.otp.config),\n    useRealtime,\n    visibleItinerary: activeSearch && activeSearch.visibleItinerary\n  }\n}\n\nconst mapDispatchToProps = (dispatch, ownProps) => {\n  // FIXME: update signature of these methods,\n  // so that only one argument is passed,\n  // e.g. setActiveLeg({ index, leg })\n  return {\n    setActiveItinerary: payload => dispatch(setActiveItinerary(payload)),\n    // FIXME\n    setActiveLeg: (index, leg) => {\n      dispatch(setActiveLeg({index, leg}))\n    },\n    // FIXME\n    setActiveStep: (index, step) => {\n      dispatch(setActiveStep({index, step}))\n    },\n    setUseRealtimeResponse: payload => dispatch(setUseRealtimeResponse(payload)),\n    setVisibleItinerary: payload => dispatch(setVisibleItinerary(payload)),\n    updateItineraryFilter: payload => dispatch(updateItineraryFilter(payload))\n  }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(\n  NarrativeItineraries\n)\n"]}