{"version":3,"sources":["user-account-screen.js"],"names":["UserAccountScreen","props","newUserData","userData","state","setState","createOrUpdateUser","routeTo","_updateUserPrefs","_handleExit","Pane","_updateUserState","terms","_hookUserData","TermsOfUsePane","notifications","NotificationPrefsPane","verifyPhone","PhoneVerificationPane","locations","FavoriteLocationsPane","finish","AccountSetupFinishPane","loggedInUser","auth","formContents","user","email_verified","_handleExitAndSave","_panes","Component","mapStateToProps","ownProps","mapDispatchToProps"],"mappings":"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","sourcesContent":["import clone from 'lodash/cloneDeep'\nimport React, { Component } from 'react'\nimport { connect } from 'react-redux'\nimport { withLoginRequired } from 'use-auth0-hooks'\n\nimport { routeTo } from '../../actions/ui'\nimport { createOrUpdateUser } from '../../actions/user'\nimport { isNewUser } from '../../util/user'\nimport DesktopNav from '../app/desktop-nav'\nimport AccountSetupFinishPane from './account-setup-finish-pane'\nimport ExistingAccountDisplay from './existing-account-display'\nimport FavoriteLocationsPane from './favorite-locations-pane'\nimport NewAccountWizard from './new-account-wizard'\nimport NotificationPrefsPane from './notification-prefs-pane'\nimport PhoneVerificationPane from './phone-verification-pane'\nimport TermsOfUsePane from './terms-of-use-pane'\nimport VerifyEmailScreen from './verify-email-screen'\nimport withLoggedInUserSupport from './with-logged-in-user-support'\n\n/**\n * This screen handles creating/updating OTP user account settings.\n */\nclass UserAccountScreen extends Component {\n  constructor (props) {\n    super(props)\n\n    this.state = {\n      userData: clone(props.loggedInUser)\n    }\n  }\n\n  _updateUserState = newUserData => {\n    const { userData } = this.state\n    this.setState({\n      userData: {\n        ...userData,\n        ...newUserData\n      }\n    })\n  }\n\n  _updateUserPrefs = async () => {\n    // TODO: Change state of Save button while the update action takes place.\n\n    const { createOrUpdateUser } = this.props\n    const { userData } = this.state\n    await createOrUpdateUser(userData)\n\n    // TODO: Handle UI feedback (currently an alert() dialog inside createOrUpdateUser).\n  }\n\n  _handleExit = () => {\n    // On exit, route to default search route.\n    this.props.routeTo('/')\n  }\n\n  _handleExitAndSave = async () => {\n    await this._updateUserPrefs()\n    this._handleExit()\n  }\n\n  /**\n   * Hook userData, onUserDataChange on some panes upon rendering.\n   * This returns a new render function for the passed component\n   * that allows passing other props to it later if needed.\n   */\n  _hookUserData = Pane => props => {\n    const { userData } = this.state\n    return (\n      <Pane\n        onUserDataChange={this._updateUserState}\n        userData={userData}\n        {...props}\n      />\n    )\n  }\n\n  // Make an index of pane components, so we don't render all panes at once on every render.\n  // Hook some panes the userData and onUserDataChange props.\n  _panes = {\n    terms: this._hookUserData(TermsOfUsePane),\n    notifications: this._hookUserData(NotificationPrefsPane),\n    verifyPhone: PhoneVerificationPane,\n    locations: this._hookUserData(FavoriteLocationsPane),\n    finish: AccountSetupFinishPane\n  }\n\n  // TODO: Update title bar during componentDidMount.\n\n  render () {\n    const { auth, loggedInUser } = this.props\n    const { userData } = this.state\n\n    let formContents\n    if (isNewUser(loggedInUser)) {\n      if (!auth.user.email_verified) {\n        // Check and prompt for email verification first to avoid extra user wait.\n        formContents = <VerifyEmailScreen />\n      } else {\n        // New users are shown \"wizard\" (step-by-step) mode\n        // (includes when a \"new\" user clicks 'My Account' from the account menu in the nav bar).\n        formContents = (\n          <NewAccountWizard\n            onComplete={this._handleExitAndSave}\n            panes={this._panes}\n            userData={userData}\n          />\n        )\n      }\n    } else {\n      formContents = (\n        // Existing users are shown all panes together.\n        <ExistingAccountDisplay\n          onCancel={this._handleExit}\n          onComplete={this._handleExitAndSave}\n          panes={this._panes}\n        />\n      )\n    }\n\n    return (\n      <div className='otp'>\n        {/* TODO: Do mobile view. */}\n        <DesktopNav />\n        <form className='container'>\n          {formContents}\n        </form>\n      </div>\n    )\n  }\n}\n\n// connect to the redux store\n\nconst mapStateToProps = (state, ownProps) => {\n  return {\n    loggedInUser: state.user.loggedInUser\n  }\n}\n\nconst mapDispatchToProps = {\n  createOrUpdateUser,\n  routeTo\n}\n\nexport default withLoggedInUserSupport(\n  withLoginRequired(connect(mapStateToProps, mapDispatchToProps)(UserAccountScreen)),\n  true\n)\n"]}