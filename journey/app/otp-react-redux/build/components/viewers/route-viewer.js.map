{"version":3,"sources":["route-viewer.js"],"names":["operatorIndexForRoute","transitOperators","route","agency","index","findIndex","o","id","toLowerCase","split","order","getContrastYIQ","hexcolor","replace","r","parseInt","substr","g","b","yiq","RouteViewer","Component","props","setMainPanelContent","componentDidMount","findRoutes","render","findRoute","hideBackButton","languageConfig","routes","setViewedRoute","viewedRoute","sortedRoutes","Object","values","sort","coreUtils","routeComparator","agencySortedRoutes","length","a","_backClicked","routeViewer","routeViewerDetails","clear","map","routeId","PropTypes","bool","object","RouteRow","PureComponent","isActive","operator","defaultRouteColor","defaultRouteTextColor","longNameSplitter","backgroundColor","color","contrastColor","textColor","longName","nameParts","shortName","borderBottom","padding","width","_onClick","display","marginTop","fontSize","fontWeight","animation","url","mapStateToProps","state","ownProps","otp","config","transitIndex","ui","language","mapDispatchToProps"],"mappings":"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","sourcesContent":["import coreUtils from '@opentripplanner/core-utils'\nimport React, { Component, PureComponent } from 'react'\nimport PropTypes from 'prop-types'\nimport { Label, Button } from 'react-bootstrap'\nimport { VelocityTransitionGroup } from 'velocity-react'\nimport { connect } from 'react-redux'\n\nimport Icon from '../narrative/icon'\n\nimport { setMainPanelContent, setViewedRoute } from '../../actions/ui'\nimport { findRoutes, findRoute } from '../../actions/api'\n\nfunction operatorIndexForRoute (transitOperators, route) {\n  if (!route.agency) return 0\n  const index = transitOperators.findIndex(o =>\n    o.id.toLowerCase() === route.agency.id.split(':')[0].toLowerCase())\n  if (index !== -1 && typeof transitOperators[index].order !== 'undefined') return transitOperators[index].order\n  else return 0\n}\n\n/**\n * Determine the appropriate contrast color for text (white or black) based on\n * the input hex string (e.g., '#ff00ff') value.\n *\n * From https://stackoverflow.com/a/11868398/915811\n *\n * TODO: Move to @opentripplanner/core-utils once otp-rr uses otp-ui library.\n */\nfunction getContrastYIQ (hexcolor) {\n  hexcolor = hexcolor.replace('#', '')\n  const r = parseInt(hexcolor.substr(0, 2), 16)\n  const g = parseInt(hexcolor.substr(2, 2), 16)\n  const b = parseInt(hexcolor.substr(4, 2), 16)\n  const yiq = ((r * 299) + (g * 587) + (b * 114)) / 1000\n  return (yiq >= 128) ? '000000' : 'ffffff'\n}\n\nclass RouteViewer extends Component {\n  static propTypes = {\n    hideBackButton: PropTypes.bool,\n    routes: PropTypes.object\n  }\n\n  _backClicked = () => this.props.setMainPanelContent(null)\n\n  componentDidMount () {\n    this.props.findRoutes()\n  }\n\n  render () {\n    const {\n      findRoute,\n      hideBackButton,\n      languageConfig,\n      transitOperators,\n      routes,\n      setViewedRoute,\n      viewedRoute\n    } = this.props\n    const sortedRoutes = routes\n      ? Object.values(routes).sort(coreUtils.route.routeComparator)\n      : []\n    const agencySortedRoutes = transitOperators.length > 0\n      ? sortedRoutes.sort((a, b) => {\n        return operatorIndexForRoute(transitOperators, a) - operatorIndexForRoute(transitOperators, b)\n      })\n      : sortedRoutes\n    return (\n      <div className='route-viewer'>\n        {/* Header Block */}\n        <div className='route-viewer-header'>\n          {/* Back button */}\n          {!hideBackButton && (\n            <div className='back-button-container'>\n              <Button\n                bsSize='small'\n                onClick={this._backClicked}\n              ><Icon type='arrow-left' />Back</Button>\n            </div>\n          )}\n\n          {/* Header Text */}\n          <div className='header-text'>\n            {languageConfig.routeViewer || 'Visualizza Linee'}\n          </div>\n          <div className=''>\n            {languageConfig.routeViewerDetails}\n          </div>\n          <div style={{ clear: 'both' }} />\n        </div>\n\n        <div className='route-viewer-body'>\n          {agencySortedRoutes\n            .map(route => {\n              // Find operator based on agency_id (extracted from OTP route ID).\n              // TODO: re-implement multi-agency logos for route viewer.\n              // const operator = operatorForRoute(transitOperators, route) || {}\n              return (\n                <RouteRow\n                  findRoute={findRoute}\n                  isActive={viewedRoute && viewedRoute.routeId === route.id}\n                  key={route.id}\n                  // operator={operator}\n                  route={route}\n                  setViewedRoute={setViewedRoute}\n                />\n              )\n            })\n          }\n        </div>\n      </div>\n    )\n  }\n}\n\nclass RouteRow extends PureComponent {\n  _onClick = () => {\n    const { findRoute, isActive, route, setViewedRoute } = this.props\n    if (isActive) {\n      // Deselect current route if active.\n      setViewedRoute({ routeId: null })\n    } else {\n      // Otherwise, set active and fetch route patterns.\n      findRoute({ routeId: route.id })\n      setViewedRoute({ routeId: route.id })\n    }\n  }\n\n  render () {\n    const {isActive, route, operator} = this.props\n    const {defaultRouteColor, defaultRouteTextColor, longNameSplitter} = operator || {}\n    const backgroundColor = `#${defaultRouteColor || route.color || 'ffffff'}`\n    // NOTE: text color is not a part of short response route object, so there\n    // is no way to determine from OTP what the text color should be if the\n    // background color is, say, black. Instead, determine the appropriate\n    // contrast color and use that if no text color is available.\n    const contrastColor = getContrastYIQ(backgroundColor)\n    const color = `#${defaultRouteTextColor || route.textColor || contrastColor}`\n    // Default long name is empty string (long name is an optional GTFS value).\n    let longName = ''\n    if (route.longName) {\n      // Attempt to split route name if splitter is defined for operator (to\n      // remove short name value from start of long name value).\n      const nameParts = route.longName.split(longNameSplitter)\n      longName = (longNameSplitter && nameParts.length > 1)\n        ? nameParts[1]\n        : route.longName\n      // If long name and short name are identical, set long name to be an empty\n      // string.\n      if (longName === route.shortName) longName = ''\n    }\n    return (\n      <div\n        style={{\n          borderBottom: '1px solid gray',\n          backgroundColor: isActive ? '#f6f8fa' : 'white'\n        }}>\n        <Button className='clear-button-formatting' style={{ padding: 8, width: '100%' }}\n          onClick={this._onClick}\n        >\n          <div style={{display: 'inline-block'}}>\n            {// TODO: re-implement multi-agency logos for route viewer.\n              // Currently, the agency object is not nested within the get all\n              // routes endpoint and causing this to only display transitOperators for\n              // the selected route.\n              // operator && <img src={operator.logo} style={{marginRight: '5px'}} height={25} />\n            }\n          </div>\n          <div style={{display: 'inline-block', marginTop: '2px'}}>\n            <Label\n              style={{\n                backgroundColor: backgroundColor === '#ffffff' ? 'rgba(0,0,0,0)' : backgroundColor,\n                fontSize: 'medium',\n                fontWeight: 400,\n                color\n              }}>\n              <b>{route.shortName}</b> {longName}\n            </Label>\n          </div>\n        </Button>\n        <VelocityTransitionGroup enter={{animation: 'slideDown'}} leave={{animation: 'slideUp'}}>\n          {isActive && (\n            <div style={{ padding: 8 }}>\n              {route.url\n                ? <a href={route.url} target='_blank'>Route Details</a>\n                : 'No route URL provided.'\n              }\n            </div>\n          )}\n        </VelocityTransitionGroup>\n      </div>\n    )\n  }\n}\n// connect to redux store\n\nconst mapStateToProps = (state, ownProps) => {\n  return {\n    transitOperators: state.otp.config.transitOperators,\n    routes: state.otp.transitIndex.routes,\n    viewedRoute: state.otp.ui.viewedRoute,\n    languageConfig: state.otp.config.language\n  }\n}\n\nconst mapDispatchToProps = {\n  findRoute,\n  findRoutes,\n  setMainPanelContent,\n  setViewedRoute\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(RouteViewer)\n"]}