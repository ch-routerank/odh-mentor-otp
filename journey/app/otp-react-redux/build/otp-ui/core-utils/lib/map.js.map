{"version":3,"sources":["map.js"],"names":["Object","defineProperty","exports","value","latlngToString","coordsToString","currentPositionToLocation","stringToCoords","constructLocation","getDetailText","formatStoredPlaceName","matchLatLon","itineraryToTransitive","isBikeshareStation","isEScooterStation","isCarWalkTransition","isValidLat","isValidLng","isValidLatLng","_moment","_interopRequireDefault","require","_itinerary","obj","__esModule","default","latlng","lat","toFixed","lng","lon","coords","length","map","c","join","currentPosition","error","console","warn","latitude","longitude","name","category","str","split","location","detailText","type","id","timestamp","fromNow","withDetails","displayName","toSentenceCase","location1","location2","itin","companies","tdata","journeys","streetEdges","places","patterns","routes","stops","streetEdgeId","patternId","journey","journey_id","journey_name","segments","push","place_id","place_lat","legs","from","place_lon","to","forEach","leg","idx","mode","fromPlaceId","bikeShareId","vertexType","toPlaceId","segment","hailedCar","arc","edge_id","geometry","legGeometry","place_name","getPlaceName","isTransit","hasInterStopGeometry","interStopGeometry","hasIntermediateStopGeometry","intermediateStops","ptnId","pattern","pattern_id","pattern_name","route_id","routeId","stopId","stop_id","stop_name","stop_lat","stop_lon","stop","i","points","agency_id","agencyId","route_short_name","routeShortName","route_long_name","routeLongName","route_type","routeType","route_color","routeColor","from_stop_index","to_stop_index","values","place","lastIndexOf","Number","isFinite","arr","Array","isArray"],"mappings":"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","sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.latlngToString = latlngToString;\nexports.coordsToString = coordsToString;\nexports.currentPositionToLocation = currentPositionToLocation;\nexports.stringToCoords = stringToCoords;\nexports.constructLocation = constructLocation;\nexports.getDetailText = getDetailText;\nexports.formatStoredPlaceName = formatStoredPlaceName;\nexports.matchLatLon = matchLatLon;\nexports.itineraryToTransitive = itineraryToTransitive;\nexports.isBikeshareStation = isBikeshareStation;\nexports.isEScooterStation = isEScooterStation;\nexports.isCarWalkTransition = isCarWalkTransition;\nexports.isValidLat = isValidLat;\nexports.isValidLng = isValidLng;\nexports.isValidLatLng = isValidLatLng;\n\nvar _moment = _interopRequireDefault(require(\"moment\"));\n\nvar _itinerary = require(\"./itinerary\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction latlngToString(latlng) {\n  return latlng && `${latlng.lat.toFixed(5)}, ${(latlng.lng || latlng.lon).toFixed(5)}`;\n}\n\nfunction coordsToString(coords) {\n  return coords.length && coords.map(c => (+c).toFixed(5)).join(\", \");\n}\n\nfunction currentPositionToLocation(currentPosition) {\n  if (currentPosition.error || !currentPosition.coords) {\n    console.warn(\"Cannot construct location from current position due to geolocation error or missing coordinates.\");\n    return null;\n  }\n\n  return {\n    lat: currentPosition.coords.latitude,\n    lon: currentPosition.coords.longitude,\n    name: \"(Posizione Corrente)\",\n    category: \"CURRENT_LOCATION\"\n  };\n}\n\nfunction stringToCoords(str) {\n  return str && str.split(\",\").map(c => +c) || [];\n}\n\nfunction constructLocation(latlng) {\n  return {\n    name: latlngToString(latlng),\n    lat: latlng.lat,\n    lon: latlng.lng\n  };\n}\n\nfunction getDetailText(location) {\n  let detailText;\n\n  if (location.type === \"home\" || location.type === \"work\") {\n    detailText = location.name;\n  }\n\n  if (location.type === \"stop\") {\n    detailText = location.id;\n  } else if (location.type === \"recent\" && location.timestamp) {\n    detailText = (0, _moment.default)(location.timestamp).fromNow();\n  }\n\n  return detailText;\n}\n\nfunction formatStoredPlaceName(location, withDetails = true) {\n    var displayName = location.type === \"home\" || location.type === \"work\" ? (0, _itinerary.toSentenceCase)(location.type) : location.name;\n    displayName = location.type === \"home\" ? \"$_home_$\" : (location.type === \"work\" ? \"$_work_$\": location.name);\n  if (withDetails) {\n    const detailText = getDetailText(location);\n    if (detailText) displayName += ` (${detailText})`;\n  }\n\n  return displayName;\n}\n\nfunction matchLatLon(location1, location2) {\n  if (!location1 || !location2) return location1 === location2;\n  return location1.lat === location2.lat && location1.lon === location2.lon;\n}\n\nfunction itineraryToTransitive(itin, companies) {\n  const tdata = {\n    journeys: [],\n    streetEdges: [],\n    places: [],\n    patterns: [],\n    routes: [],\n    stops: []\n  };\n  const routes = {};\n  const stops = {};\n  let streetEdgeId = 0;\n  let patternId = 0;\n  const journey = {\n    journey_id: \"itin\",\n    journey_name: \"Iterarary-derived Journey\",\n    segments: []\n  }; // add 'from' and 'to' places to the tdata places array\n\n  tdata.places.push({\n    place_id: \"from\",\n    place_lat: itin.legs[0].from.lat,\n    place_lon: itin.legs[0].from.lon\n  });\n  tdata.places.push({\n    place_id: \"to\",\n    place_lat: itin.legs[itin.legs.length - 1].to.lat,\n    place_lon: itin.legs[itin.legs.length - 1].to.lon\n  });\n  itin.legs.forEach((leg, idx) => {\n    if (leg.mode === \"WALK\" || leg.mode === \"BICYCLE\" || leg.mode === \"CAR\" || leg.mode === \"MICROMOBILITY\") {\n      let fromPlaceId;\n\n      if (leg.from.bikeShareId) {\n        fromPlaceId = `bicycle_rent_station_${leg.from.bikeShareId}`;\n      } else if (leg.from.vertexType === \"VEHICLERENTAL\") {\n        fromPlaceId = `escooter_rent_station_${leg.from.name}`;\n      } else if (leg.mode === \"CAR\" && idx > 0 && itin.legs[idx - 1].mode === \"WALK\") {\n        // create a special place ID for car legs preceeded by walking legs\n        fromPlaceId = `itin_car_${streetEdgeId}_from`;\n      } else {\n        fromPlaceId = `itin_street_${streetEdgeId}_from`;\n      }\n\n      let toPlaceId;\n\n      if (leg.to.bikeShareId) {\n        toPlaceId = `bicycle_rent_station_${leg.to.bikeShareId}`;\n      } else if (leg.to.vertexType === \"VEHICLERENTAL\") {\n        toPlaceId = `escooter_rent_station_${leg.to.name}`;\n      } else if (leg.mode === \"CAR\" && idx < itin.legs.length - 1 && itin.legs[idx + 1].mode === \"WALK\") {\n        // create a special place ID for car legs followed by walking legs\n        toPlaceId = `itin_car_${streetEdgeId}_to`;\n      } else {\n        toPlaceId = `itin_street_${streetEdgeId}_to`;\n      }\n\n      const segment = {\n        type: leg.mode,\n        streetEdges: [streetEdgeId],\n        from: {\n          type: \"PLACE\",\n          place_id: fromPlaceId\n        },\n        to: {\n          type: \"PLACE\",\n          place_id: toPlaceId\n        }\n      }; // For TNC segments, draw using an arc\n\n      if (leg.mode === \"CAR\" && leg.hailedCar) segment.arc = true;\n      journey.segments.push(segment);\n      tdata.streetEdges.push({\n        edge_id: streetEdgeId,\n        geometry: leg.legGeometry\n      });\n      tdata.places.push({\n        place_id: fromPlaceId,\n        // Do not label the from place in addition to the to place. Otherwise,\n        // in some cases (bike rental station) the label for a single place will\n        // appear twice on the rendered transitive view.\n        // See https://github.com/conveyal/trimet-mod-otp/issues/152\n        // place_name: leg.from.name,\n        place_lat: leg.from.lat,\n        place_lon: leg.from.lon\n      });\n      tdata.places.push({\n        place_id: toPlaceId,\n        place_name: (0, _itinerary.getPlaceName)(leg.to, companies),\n        place_lat: leg.to.lat,\n        place_lon: leg.to.lon\n      });\n      streetEdgeId++;\n    }\n\n    if ((0, _itinerary.isTransit)(leg.mode)) {\n      // determine if we have valid inter-stop geometry\n      const hasInterStopGeometry = !!leg.interStopGeometry;\n      const hasIntermediateStopGeometry = hasInterStopGeometry && leg.intermediateStops && leg.interStopGeometry.length === leg.intermediateStops.length + 1; // create leg-specific pattern\n\n      const ptnId = `ptn_${patternId}`;\n      const pattern = {\n        pattern_id: ptnId,\n        pattern_name: `Pattern ${patternId}`,\n        route_id: leg.routeId,\n        stops: []\n      }; // add 'from' stop to stops dictionary and pattern object\n\n      stops[leg.from.stopId] = {\n        stop_id: leg.from.stopId,\n        stop_name: leg.from.name,\n        stop_lat: leg.from.lat,\n        stop_lon: leg.from.lon\n      };\n      pattern.stops.push({\n        stop_id: leg.from.stopId\n      }); // add intermediate stops to stops dictionary and pattern object\n\n      if (leg.intermediateStops) {\n        leg.intermediateStops.forEach((stop, i) => {\n          stops[stop.stopId] = {\n            stop_id: stop.stopId,\n            stop_name: stop.name,\n            stop_lat: stop.lat,\n            stop_lon: stop.lon\n          };\n          pattern.stops.push({\n            stop_id: stop.stopId,\n            geometry: hasIntermediateStopGeometry && leg.interStopGeometry[i].points\n          });\n        });\n      } // add 'to' stop to stops dictionary and pattern object\n\n\n      stops[leg.to.stopId] = {\n        stop_id: leg.to.stopId,\n        stop_name: leg.to.name,\n        stop_lat: leg.to.lat,\n        stop_lon: leg.to.lon\n      };\n      pattern.stops.push({\n        stop_id: leg.to.stopId,\n        geometry: hasInterStopGeometry && (hasIntermediateStopGeometry ? leg.interStopGeometry[leg.interStopGeometry.length - 1].points : leg.legGeometry.points)\n      }); // add route to the route dictionary\n\n      routes[leg.routeId] = {\n        agency_id: leg.agencyId,\n        route_id: leg.routeId,\n        route_short_name: leg.routeShortName || \"\",\n        route_long_name: leg.routeLongName || \"\",\n        route_type: leg.routeType,\n        route_color: leg.routeColor\n      }; // add the pattern to the tdata patterns array\n\n      tdata.patterns.push(pattern); // add the pattern refrerence to the journey object\n\n      journey.segments.push({\n        type: \"TRANSIT\",\n        patterns: [{\n          pattern_id: ptnId,\n          from_stop_index: 0,\n          to_stop_index: leg.intermediateStops ? leg.intermediateStops.length + 2 - 1 : 1\n        }]\n      });\n      patternId++;\n    }\n  }); // add the routes and stops to the tdata arrays\n\n  tdata.routes.push(...Object.values(routes));\n  tdata.stops.push(...Object.values(stops)); // add the journey to the tdata journeys array\n\n  tdata.journeys.push(journey); // console.log('derived tdata', tdata);\n\n  return tdata;\n}\n\nfunction isBikeshareStation(place) {\n  return place.place_id.lastIndexOf(\"bicycle_rent_station\") !== -1;\n}\n\nfunction isEScooterStation(place) {\n  return place.place_id.lastIndexOf(\"escooter_rent_station\") !== -1;\n}\n\nfunction isCarWalkTransition(place) {\n  return place.place_id.lastIndexOf(\"itin_car_\") !== -1;\n}\n\nfunction isValidLat(lat) {\n  return Number.isFinite(lat) && lat >= -90 && lat <= 90;\n}\n\nfunction isValidLng(lng) {\n  return Number.isFinite(lng) && lng >= -180 && lng <= 180;\n}\n\nfunction isValidLatLng(arr) {\n  return Array.isArray(arr) && arr.length === 2 && isValidLat(arr[0]) && isValidLng(arr[1]);\n}\n"]}