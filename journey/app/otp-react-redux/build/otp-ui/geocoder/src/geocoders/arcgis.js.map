{"version":3,"sources":["arcgis.js"],"names":["ArcGISGeocoder","Geocoder","getLocationFromGeocodedFeature","feature","geometry","prototype","api","search","magicKey","text","then","response","firstFeature","features","location","lonlat","fromCoordinates","coordinates","name","properties","label","rawGeocodedFeature","rewriteAutocompleteResponse","filter","isCollection","map","rewriteReverseResponse","query","lat","lon"],"mappings":";;;;;;;AAAA;;AAEA;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACe,MAAMA,cAAN,SAA6BC,yBAA7B,CAAsC;AACnD;AACF;AACA;AACA;AACA;AACEC,EAAAA,8BAA8B,CAACC,OAAD,EAAU;AACtC;AACA;AACA,QAAIA,OAAO,CAACC,QAAZ,EAAsB;AACpB,aAAOH,0BAASI,SAAT,CAAmBH,8BAAnB,CAAkDC,OAAlD,CAAP;AACD,KALqC,CAMtC;AACA;;;AACA,WAAO,KAAKG,GAAL,CACJC,MADI,CACG;AAAEC,MAAAA,QAAQ,EAAEL,OAAO,CAACK,QAApB;AAA8BC,MAAAA,IAAI,EAAEN,OAAO,CAACM;AAA5C,KADH,EAEJC,IAFI,CAECC,QAAQ,IAAI;AAChB,YAAMC,YAAY,GAAGD,QAAQ,CAACE,QAAT,CAAkB,CAAlB,CAArB;;AACA,YAAMC,QAAQ,GAAGC,gBAAOC,eAAP,CACfJ,YAAY,CAACR,QAAb,CAAsBa,WADP,CAAjB;;AAGAH,MAAAA,QAAQ,CAACI,IAAT,GAAgBN,YAAY,CAACO,UAAb,CAAwBC,KAAxC;AACAN,MAAAA,QAAQ,CAACO,kBAAT,GAA8BT,YAA9B;AACA,aAAOE,QAAP;AACD,KAVI,CAAP;AAWD;AAED;AACF;AACA;AACA;;;AACEQ,EAAAA,2BAA2B,CAACX,QAAD,EAAW;AACpC,WAAO;AACL;AACA;AACAE,MAAAA,QAAQ,EAAEF,QAAQ,CAACE,QAAT,CACPU,MADO,CACApB,OAAO,IAAI,CAACA,OAAO,CAACqB,YADpB,EAER;AAFQ,OAGPC,GAHO,CAGHtB,OAAO,KAAK,EACf,GAAGA,OADY;AAEfgB,QAAAA,UAAU,EAAE;AACVC,UAAAA,KAAK,EAAEjB,OAAO,CAACM;AADL;AAFG,OAAL,CAHJ;AAHL,KAAP;AAaD;AAED;AACF;AACA;AACA;;;AACEiB,EAAAA,sBAAsB,CAACf,QAAD,EAAW;AAC/B,UAAM;AAAEE,MAAAA,QAAF;AAAYc,MAAAA;AAAZ,QAAsBhB,QAA5B;AACA,UAAM;AAAEiB,MAAAA,GAAF;AAAOC,MAAAA;AAAP,QAAeF,KAArB;AACA,UAAMf,YAAY,GAAGC,QAAQ,CAAC,CAAD,CAA7B;AACA,WAAO;AACLe,MAAAA,GADK;AAELC,MAAAA,GAFK;AAGLX,MAAAA,IAAI,EAAEN,YAAY,CAACO,UAAb,CAAwBC,KAHzB;AAILC,MAAAA,kBAAkB,EAAET;AAJf,KAAP;AAMD;;AA7DkD","sourcesContent":["import lonlat from \"@conveyal/lonlat\";\n\nimport Geocoder from \"./abstract-geocoder\";\n\n/**\n * Geocoder implementation for the ArcGIS geocoder.\n * See https://developers.arcgis.com/rest/geocode/api-reference/overview-world-geocoding-service.htm\n *\n * @extends Geocoder\n */\nexport default class ArcGISGeocoder extends Geocoder {\n  /**\n   * Using the given magicKey and text, perform a search query to get detailed\n   * address and GPS data. Return data in an application-specific location\n   * format.\n   */\n  getLocationFromGeocodedFeature(feature) {\n    // If feature was returned from 'search' query, it will already be\n    // structured properly.\n    if (feature.geometry) {\n      return Geocoder.prototype.getLocationFromGeocodedFeature(feature);\n    }\n    // If feature returned from autocomplete, we need to use the magicKey to get\n    // the location's coordinates.\n    return this.api\n      .search({ magicKey: feature.magicKey, text: feature.text })\n      .then(response => {\n        const firstFeature = response.features[0];\n        const location = lonlat.fromCoordinates(\n          firstFeature.geometry.coordinates\n        );\n        location.name = firstFeature.properties.label;\n        location.rawGeocodedFeature = firstFeature;\n        return location;\n      });\n  }\n\n  /**\n   * Rewrite an autocomplete response into an application specific data format.\n   * Also, filter out any results that are collections.\n   */\n  rewriteAutocompleteResponse(response) {\n    return {\n      // remove any autocomplete results that are collections\n      // (eg multiple Starbucks)\n      features: response.features\n        .filter(feature => !feature.isCollection)\n        // add label property so location-field can handle things ok\n        .map(feature => ({\n          ...feature,\n          properties: {\n            label: feature.text\n          }\n        }))\n    };\n  }\n\n  /**\n   * Rewrite the response into an application-specific data format using the\n   * first feature returned from the geocoder.\n   */\n  rewriteReverseResponse(response) {\n    const { features, query } = response;\n    const { lat, lon } = query;\n    const firstFeature = features[0];\n    return {\n      lat,\n      lon,\n      name: firstFeature.properties.label,\n      rawGeocodedFeature: firstFeature\n    };\n  }\n}\n"]}