{"version":3,"sources":["leg-diagram-preview.js"],"names":["Object","defineProperty","exports","value","default","_itinerary","require","_types","_propTypes","_interopRequireDefault","_react","_interopRequireWildcard","_reactResizeDetector","Styled","_getRequireWildcardCache","WeakMap","cache","obj","__esModule","has","get","newObj","hasPropertyDescriptor","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","_defineProperty","enumerable","configurable","writable","METERS_TO_FEET","generateSvg","profile","width","height","points","ptArr","traversed","minElev","maxElev","pts","map","pt","x","y","join","createElement","fill","stroke","strokeWidth","LegDiagramPreview","Component","constructor","props","setState","diagramVisible","leg","startTime","setLegDiagram","isActive","elev","Math","round","state","render","showElevationProfile","getElevationProfile","steps","distance","mode","PreviewContainer","active","PreviewDiagram","tabIndex","title","role","onClick","onExpandClick","PreviewDiagramTitle","PreviewDiagramElevationGain","formatElevation","gain","PreviewDiagramElevationLoss","loss","length","handleWidth","onResize","propTypes","legType","isRequired","func","bool","defaultProps","_default"],"mappings":"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","sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _itinerary = require(\"@opentripplanner/core-utils/lib/itinerary\");\n\nvar _types = require(\"@opentripplanner/core-utils/lib/types\");\n\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _reactResizeDetector = _interopRequireDefault(require(\"react-resize-detector\"));\n\nvar Styled = _interopRequireWildcard(require(\"../styled\"));\n\nfunction _getRequireWildcardCache() { if (typeof WeakMap !== \"function\") return null; var cache = new WeakMap(); _getRequireWildcardCache = function () { return cache; }; return cache; }\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nconst METERS_TO_FEET = 1;\n\nfunction generateSvg(profile, width) {\n  const height = 30;\n  const {\n    points: ptArr,\n    traversed\n  } = profile;\n  let {\n    minElev,\n    maxElev\n  } = profile; // Pad the min-max range by 25m on either side\n\n  minElev -= 25;\n  maxElev += 25; // Transform the point array and store it as an SVG-ready string\n\n  const pts = ptArr.map(pt => {\n    const x = pt[0] / traversed * width;\n    const y = height - height * (pt[1] - minElev) / (maxElev - minElev);\n    return `${x},${y}`;\n  }).join(\" \"); // Render the SVG\n\n  return /*#__PURE__*/_react.default.createElement(\"svg\", {\n    height: height,\n    width: width\n  }, /*#__PURE__*/_react.default.createElement(\"polyline\", {\n    points: pts,\n    fill: \"none\",\n    stroke: \"black\",\n    strokeWidth: 1.3\n  }));\n}\n\nclass LegDiagramPreview extends _react.Component {\n  constructor(props) {\n    super(props);\n\n    _defineProperty(this, \"onResize\", width => {\n      if (width > 0) {\n        this.setState({\n          width\n        });\n      }\n    });\n\n    _defineProperty(this, \"isActive\", () => {\n      const {\n        diagramVisible,\n        leg\n      } = this.props;\n      return diagramVisible && diagramVisible.startTime === leg.startTime;\n    });\n\n    _defineProperty(this, \"onExpandClick\", () => {\n      const {\n        leg,\n        setLegDiagram\n      } = this.props;\n      if (this.isActive()) setLegDiagram(null);else setLegDiagram(leg);\n    });\n\n    _defineProperty(this, \"formatElevation\", elev => `${Math.round(elev)}'`);\n\n    this.state = {\n      width: null\n    };\n  }\n\n  render() {\n    const {\n      leg,\n      showElevationProfile\n    } = this.props;\n    const {\n      width\n    } = this.state;\n    if (!showElevationProfile) return null;\n    const profile = (0, _itinerary.getElevationProfile)(leg.steps); // Don't show for very short legs\n\n    if (leg.distance < 500 || leg.mode === \"CAR\") return null;\n    return /*#__PURE__*/_react.default.createElement(Styled.PreviewContainer, {\n      active: this.isActive()\n    }, /*#__PURE__*/_react.default.createElement(Styled.PreviewDiagram, {\n      tabIndex: \"0\",\n      title: \"Toggle elevation chart\",\n      role: \"button\",\n      onClick: this.onExpandClick\n    }, /*#__PURE__*/_react.default.createElement(Styled.PreviewDiagramTitle, null, \"$_altimetry_$\", \" \", /*#__PURE__*/_react.default.createElement(Styled.PreviewDiagramElevationGain, null, \"\\u2191\", this.formatElevation(profile.gain * METERS_TO_FEET), \"  \"), /*#__PURE__*/_react.default.createElement(Styled.PreviewDiagramElevationLoss, null, \"\\u2193\", this.formatElevation(-profile.loss * METERS_TO_FEET))), profile.points.length > 0 ? generateSvg(profile, width) : \"$_altimetry_unavailable_$.\", /*#__PURE__*/_react.default.createElement(_reactResizeDetector.default, {\n      handleWidth: true,\n      onResize: this.onResize\n    })));\n  }\n\n}\n\nLegDiagramPreview.propTypes = {\n  diagramVisible: _types.legType,\n  leg: _types.legType.isRequired,\n  setLegDiagram: _propTypes.default.func.isRequired,\n  showElevationProfile: _propTypes.default.bool.isRequired\n};\nLegDiagramPreview.defaultProps = {\n  diagramVisible: null\n};\nvar _default = LegDiagramPreview;\nexports.default = _default;"]}