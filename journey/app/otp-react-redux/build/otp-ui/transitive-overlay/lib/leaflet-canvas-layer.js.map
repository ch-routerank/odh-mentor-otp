{"version":3,"sources":["leaflet-canvas-layer.js"],"names":["L","DomUtil","setTransform","el","offset","scale","pos","Point","style","TRANSFORM","Browser","ie3d","x","y","CanvasLayer","Layer","Class","extend","initialize","options","_map","_canvas","_frame","_delegate","setOptions","delegate","del","needRedraw","Util","requestAnimFrame","drawLayer","_onLayerDidResize","resizeEvent","width","newSize","height","_onLayerDidMove","topLeft","containerPointToLayerPoint","setPosition","getEvents","events","resize","moveend","zoom","zoomAnimation","any3d","zoomanim","_animateZoom","onAdd","map","create","tiles","size","getSize","animated","addClass","_panes","overlayPane","appendChild","on","onLayerDidMount","onRemove","onLayerWillUnmount","getPanes","removeChild","off","addTo","addLayer","LatLonToMercator","latlon","lng","Math","PI","log","tan","lat","bounds","getBounds","getZoom","center","getCenter","corner","containerPointToLatLng","onDrawLayer","layer","canvas","_setTransform","e","getZoomScale","_latLngBoundsToNewLayerBounds","min","_getCenterOffset","_multiplyBy","subtract","_getMapPanePos","canvasLayer"],"mappings":"AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AACAA,CAAC,CAACC,OAAF,CAAUC,YAAV,GAAyBF,CAAC,CAACC,OAAF,CAAUC,YAAV,IAA0B,UAAUC,EAAV,EAAcC,MAAd,EAAsBC,KAAtB,EAA6B;AAC9E,MAAIC,GAAG,GAAGF,MAAM,IAAI,IAAIJ,CAAC,CAACO,KAAN,CAAY,CAAZ,EAAe,CAAf,CAApB;AACAJ,EAAAA,EAAE,CAACK,KAAH,CAASR,CAAC,CAACC,OAAF,CAAUQ,SAAnB,IAAgC,CAACT,CAAC,CAACU,OAAF,CAAUC,IAAV,GAAiB,eAAeL,GAAG,CAACM,CAAnB,GAAuB,KAAvB,GAA+BN,GAAG,CAACO,CAAnC,GAAuC,KAAxD,GAAgE,iBAAiBP,GAAG,CAACM,CAArB,GAAyB,KAAzB,GAAiCN,GAAG,CAACO,CAArC,GAAyC,OAA1G,KAAsHR,KAAK,GAAG,YAAYA,KAAZ,GAAoB,GAAvB,GAA6B,EAAxJ,CAAhC;AACD,CAHD,C,CAGG;;;AAGHL,CAAC,CAACc,WAAF,GAAgB,CAACd,CAAC,CAACe,KAAF,GAAUf,CAAC,CAACe,KAAZ,GAAoBf,CAAC,CAACgB,KAAvB,EAA8BC,MAA9B,CAAqC;AACnD;AACAC,EAAAA,UAAU,EAAE,UAAUC,OAAV,EAAmB;AAC7B,SAAKC,IAAL,GAAY,IAAZ;AACA,SAAKC,OAAL,GAAe,IAAf;AACA,SAAKC,MAAL,GAAc,IAAd;AACA,SAAKC,SAAL,GAAiB,IAAjB;AACAvB,IAAAA,CAAC,CAACwB,UAAF,CAAa,IAAb,EAAmBL,OAAnB;AACD,GARkD;AASnDM,EAAAA,QAAQ,EAAE,UAAUC,GAAV,EAAe;AACvB,SAAKH,SAAL,GAAiBG,GAAjB;AACA,WAAO,IAAP;AACD,GAZkD;AAanDC,EAAAA,UAAU,EAAE,YAAY;AACtB,QAAI,CAAC,KAAKL,MAAV,EAAkB;AAChB,WAAKA,MAAL,GAActB,CAAC,CAAC4B,IAAF,CAAOC,gBAAP,CAAwB,KAAKC,SAA7B,EAAwC,IAAxC,CAAd;AACD;;AAED,WAAO,IAAP;AACD,GAnBkD;AAoBnD;AACAC,EAAAA,iBAAiB,EAAE,UAAUC,WAAV,EAAuB;AACxC,SAAKX,OAAL,CAAaY,KAAb,GAAqBD,WAAW,CAACE,OAAZ,CAAoBtB,CAAzC;AACA,SAAKS,OAAL,CAAac,MAAb,GAAsBH,WAAW,CAACE,OAAZ,CAAoBrB,CAA1C;AACD,GAxBkD;AAyBnD;AACAuB,EAAAA,eAAe,EAAE,YAAY;AAC3B,QAAIC,OAAO,GAAG,KAAKjB,IAAL,CAAUkB,0BAAV,CAAqC,CAAC,CAAD,EAAI,CAAJ,CAArC,CAAd;;AAEAtC,IAAAA,CAAC,CAACC,OAAF,CAAUsC,WAAV,CAAsB,KAAKlB,OAA3B,EAAoCgB,OAApC;AACA,SAAKP,SAAL;AACD,GA/BkD;AAgCnD;AACAU,EAAAA,SAAS,EAAE,YAAY;AACrB,QAAIC,MAAM,GAAG;AACXC,MAAAA,MAAM,EAAE,KAAKX,iBADF;AAEXY,MAAAA,OAAO,EAAE,KAAKP,eAFH;AAGXQ,MAAAA,IAAI,EAAE,KAAKR;AAHA,KAAb;;AAMA,QAAI,KAAKhB,IAAL,CAAUD,OAAV,CAAkB0B,aAAlB,IAAmC7C,CAAC,CAACU,OAAF,CAAUoC,KAAjD,EAAwD;AACtDL,MAAAA,MAAM,CAACM,QAAP,GAAkB,KAAKC,YAAvB;AACD;;AAED,WAAOP,MAAP;AACD,GA7CkD;AA8CnD;AACAQ,EAAAA,KAAK,EAAE,UAAUC,GAAV,EAAe;AACpB,SAAK9B,IAAL,GAAY8B,GAAZ;AACA,SAAK7B,OAAL,GAAerB,CAAC,CAACC,OAAF,CAAUkD,MAAV,CAAiB,QAAjB,EAA2B,eAA3B,CAAf;AACA,SAAKC,KAAL,GAAa,EAAb;;AAEA,QAAIC,IAAI,GAAG,KAAKjC,IAAL,CAAUkC,OAAV,EAAX;;AAEA,SAAKjC,OAAL,CAAaY,KAAb,GAAqBoB,IAAI,CAACzC,CAA1B;AACA,SAAKS,OAAL,CAAac,MAAb,GAAsBkB,IAAI,CAACxC,CAA3B;AACA,QAAI0C,QAAQ,GAAG,KAAKnC,IAAL,CAAUD,OAAV,CAAkB0B,aAAlB,IAAmC7C,CAAC,CAACU,OAAF,CAAUoC,KAA5D;AACA9C,IAAAA,CAAC,CAACC,OAAF,CAAUuD,QAAV,CAAmB,KAAKnC,OAAxB,EAAiC,mBAAmBkC,QAAQ,GAAG,UAAH,GAAgB,MAA3C,CAAjC;;AAEAL,IAAAA,GAAG,CAACO,MAAJ,CAAWC,WAAX,CAAuBC,WAAvB,CAAmC,KAAKtC,OAAxC;;AAEA6B,IAAAA,GAAG,CAACU,EAAJ,CAAO,KAAKpB,SAAL,EAAP,EAAyB,IAAzB;AACA,QAAId,GAAG,GAAG,KAAKH,SAAL,IAAkB,IAA5B;AACAG,IAAAA,GAAG,CAACmC,eAAJ,IAAuBnC,GAAG,CAACmC,eAAJ,EAAvB,CAhBoB,CAgB0B;;AAE9C,SAAKlC,UAAL;AACD,GAlEkD;AAmEnD;AACAmC,EAAAA,QAAQ,EAAE,UAAUZ,GAAV,EAAe;AACvB,QAAIxB,GAAG,GAAG,KAAKH,SAAL,IAAkB,IAA5B;AACAG,IAAAA,GAAG,CAACqC,kBAAJ,IAA0BrC,GAAG,CAACqC,kBAAJ,EAA1B,CAFuB,CAE6B;;AAEpDb,IAAAA,GAAG,CAACc,QAAJ,GAAeN,WAAf,CAA2BO,WAA3B,CAAuC,KAAK5C,OAA5C;AACA6B,IAAAA,GAAG,CAACgB,GAAJ,CAAQ,KAAK1B,SAAL,EAAR,EAA0B,IAA1B;AACA,SAAKnB,OAAL,GAAe,IAAf;AACD,GA3EkD;AA4EnD;AACA8C,EAAAA,KAAK,EAAE,UAAUjB,GAAV,EAAe;AACpBA,IAAAA,GAAG,CAACkB,QAAJ,CAAa,IAAb;AACA,WAAO,IAAP;AACD,GAhFkD;AAiFnD;AACAC,EAAAA,gBAAgB,EAAE,UAAUC,MAAV,EAAkB;AAClC,WAAO;AACL1D,MAAAA,CAAC,EAAE0D,MAAM,CAACC,GAAP,GAAa,OAAb,GAAuBC,IAAI,CAACC,EAA5B,GAAiC,GAD/B;AAEL5D,MAAAA,CAAC,EAAE2D,IAAI,CAACE,GAAL,CAASF,IAAI,CAACG,GAAL,CAAS,CAAC,KAAKL,MAAM,CAACM,GAAb,IAAoBJ,IAAI,CAACC,EAAzB,GAA8B,GAAvC,CAAT,IAAwD;AAFtD,KAAP;AAID,GAvFkD;AAwFnD;AACA3C,EAAAA,SAAS,EAAE,YAAY;AACrB;AACA,QAAIuB,IAAI,GAAG,KAAKjC,IAAL,CAAUkC,OAAV,EAAX;;AAEA,QAAIuB,MAAM,GAAG,KAAKzD,IAAL,CAAU0D,SAAV,EAAb;;AAEA,QAAIlC,IAAI,GAAG,KAAKxB,IAAL,CAAU2D,OAAV,EAAX;;AAEA,QAAIC,MAAM,GAAG,KAAKX,gBAAL,CAAsB,KAAKjD,IAAL,CAAU6D,SAAV,EAAtB,CAAb;AACA,QAAIC,MAAM,GAAG,KAAKb,gBAAL,CAAsB,KAAKjD,IAAL,CAAU+D,sBAAV,CAAiC,KAAK/D,IAAL,CAAUkC,OAAV,EAAjC,CAAtB,CAAb;AACA,QAAI5B,GAAG,GAAG,KAAKH,SAAL,IAAkB,IAA5B;AACAG,IAAAA,GAAG,CAAC0D,WAAJ,IAAmB1D,GAAG,CAAC0D,WAAJ,CAAgB;AACjCC,MAAAA,KAAK,EAAE,IAD0B;AAEjCC,MAAAA,MAAM,EAAE,KAAKjE,OAFoB;AAGjCwD,MAAAA,MAAM,EAAEA,MAHyB;AAIjCxB,MAAAA,IAAI,EAAEA,IAJ2B;AAKjCT,MAAAA,IAAI,EAAEA,IAL2B;AAMjCoC,MAAAA,MAAM,EAAEA,MANyB;AAOjCE,MAAAA,MAAM,EAAEA;AAPyB,KAAhB,CAAnB;AASA,SAAK5D,MAAL,GAAc,IAAd;AACD,GA9GkD;AA+GnD;AACA;AACAiE,EAAAA,aAAa,EAAE,UAAUpF,EAAV,EAAcC,MAAd,EAAsBC,KAAtB,EAA6B;AAC1C,QAAIC,GAAG,GAAGF,MAAM,IAAI,IAAIJ,CAAC,CAACO,KAAN,CAAY,CAAZ,EAAe,CAAf,CAApB;AACAJ,IAAAA,EAAE,CAACK,KAAH,CAASR,CAAC,CAACC,OAAF,CAAUQ,SAAnB,IAAgC,CAACT,CAAC,CAACU,OAAF,CAAUC,IAAV,GAAiB,eAAeL,GAAG,CAACM,CAAnB,GAAuB,KAAvB,GAA+BN,GAAG,CAACO,CAAnC,GAAuC,KAAxD,GAAgE,iBAAiBP,GAAG,CAACM,CAArB,GAAyB,KAAzB,GAAiCN,GAAG,CAACO,CAArC,GAAyC,OAA1G,KAAsHR,KAAK,GAAG,YAAYA,KAAZ,GAAoB,GAAvB,GAA6B,EAAxJ,CAAhC;AACD,GApHkD;AAqHnD;AACA2C,EAAAA,YAAY,EAAE,UAAUwC,CAAV,EAAa;AACzB,QAAInF,KAAK,GAAG,KAAKe,IAAL,CAAUqE,YAAV,CAAuBD,CAAC,CAAC5C,IAAzB,CAAZ,CADyB,CACmB;;;AAG5C,QAAIxC,MAAM,GAAGJ,CAAC,CAACe,KAAF,GAAU,KAAKK,IAAL,CAAUsE,6BAAV,CAAwC,KAAKtE,IAAL,CAAU0D,SAAV,EAAxC,EAA+DU,CAAC,CAAC5C,IAAjE,EAAuE4C,CAAC,CAACR,MAAzE,EAAiFW,GAA3F,GAAiG,KAAKvE,IAAL,CAAUwE,gBAAV,CAA2BJ,CAAC,CAACR,MAA7B,EAAqCa,WAArC,CAAiD,CAACxF,KAAlD,EAAyDyF,QAAzD,CAAkE,KAAK1E,IAAL,CAAU2E,cAAV,EAAlE,CAA9G;AACA/F,IAAAA,CAAC,CAACC,OAAF,CAAUC,YAAV,CAAuB,KAAKmB,OAA5B,EAAqCjB,MAArC,EAA6CC,KAA7C;AACD;AA5HkD,CAArC,CAAhB;;AA+HAL,CAAC,CAACgG,WAAF,GAAgB,YAAY;AAC1B,SAAO,IAAIhG,CAAC,CAACc,WAAN,EAAP;AACD,CAFD","sourcesContent":["\"use strict\";\n\n/*\n  Generic  Canvas Layer for leaflet 0.7 and 1.0-rc,\n  copyright Stanislav Sumbera,  2016 , sumbera.com , license MIT\n  originally created and motivated by L.CanvasOverlay  available here: https://gist.github.com/Sumbera/11114288\n\n*/\n\n/* eslint-disable */\n// -- L.DomUtil.setTransform from leaflet 1.0.0 to work on 0.0.7\n//------------------------------------------------------------------------------\nL.DomUtil.setTransform = L.DomUtil.setTransform || function (el, offset, scale) {\n  var pos = offset || new L.Point(0, 0);\n  el.style[L.DomUtil.TRANSFORM] = (L.Browser.ie3d ? 'translate(' + pos.x + 'px,' + pos.y + 'px)' : 'translate3d(' + pos.x + 'px,' + pos.y + 'px,0)') + (scale ? ' scale(' + scale + ')' : '');\n}; // -- support for both  0.0.7 and 1.0.0 rc2 leaflet\n\n\nL.CanvasLayer = (L.Layer ? L.Layer : L.Class).extend({\n  // -- initialized is called on prototype\n  initialize: function (options) {\n    this._map = null;\n    this._canvas = null;\n    this._frame = null;\n    this._delegate = null;\n    L.setOptions(this, options);\n  },\n  delegate: function (del) {\n    this._delegate = del;\n    return this;\n  },\n  needRedraw: function () {\n    if (!this._frame) {\n      this._frame = L.Util.requestAnimFrame(this.drawLayer, this);\n    }\n\n    return this;\n  },\n  //-------------------------------------------------------------\n  _onLayerDidResize: function (resizeEvent) {\n    this._canvas.width = resizeEvent.newSize.x;\n    this._canvas.height = resizeEvent.newSize.y;\n  },\n  //-------------------------------------------------------------\n  _onLayerDidMove: function () {\n    var topLeft = this._map.containerPointToLayerPoint([0, 0]);\n\n    L.DomUtil.setPosition(this._canvas, topLeft);\n    this.drawLayer();\n  },\n  //-------------------------------------------------------------\n  getEvents: function () {\n    var events = {\n      resize: this._onLayerDidResize,\n      moveend: this._onLayerDidMove,\n      zoom: this._onLayerDidMove\n    };\n\n    if (this._map.options.zoomAnimation && L.Browser.any3d) {\n      events.zoomanim = this._animateZoom;\n    }\n\n    return events;\n  },\n  //-------------------------------------------------------------\n  onAdd: function (map) {\n    this._map = map;\n    this._canvas = L.DomUtil.create('canvas', 'leaflet-layer');\n    this.tiles = {};\n\n    var size = this._map.getSize();\n\n    this._canvas.width = size.x;\n    this._canvas.height = size.y;\n    var animated = this._map.options.zoomAnimation && L.Browser.any3d;\n    L.DomUtil.addClass(this._canvas, 'leaflet-zoom-' + (animated ? 'animated' : 'hide'));\n\n    map._panes.overlayPane.appendChild(this._canvas);\n\n    map.on(this.getEvents(), this);\n    var del = this._delegate || this;\n    del.onLayerDidMount && del.onLayerDidMount(); // -- callback\n\n    this.needRedraw();\n  },\n  //-------------------------------------------------------------\n  onRemove: function (map) {\n    var del = this._delegate || this;\n    del.onLayerWillUnmount && del.onLayerWillUnmount(); // -- callback\n\n    map.getPanes().overlayPane.removeChild(this._canvas);\n    map.off(this.getEvents(), this);\n    this._canvas = null;\n  },\n  //------------------------------------------------------------\n  addTo: function (map) {\n    map.addLayer(this);\n    return this;\n  },\n  // --------------------------------------------------------------------------------\n  LatLonToMercator: function (latlon) {\n    return {\n      x: latlon.lng * 6378137 * Math.PI / 180,\n      y: Math.log(Math.tan((90 + latlon.lat) * Math.PI / 360)) * 6378137\n    };\n  },\n  //------------------------------------------------------------------------------\n  drawLayer: function () {\n    // -- todo make the viewInfo properties  flat objects.\n    var size = this._map.getSize();\n\n    var bounds = this._map.getBounds();\n\n    var zoom = this._map.getZoom();\n\n    var center = this.LatLonToMercator(this._map.getCenter());\n    var corner = this.LatLonToMercator(this._map.containerPointToLatLng(this._map.getSize()));\n    var del = this._delegate || this;\n    del.onDrawLayer && del.onDrawLayer({\n      layer: this,\n      canvas: this._canvas,\n      bounds: bounds,\n      size: size,\n      zoom: zoom,\n      center: center,\n      corner: corner\n    });\n    this._frame = null;\n  },\n  // -- L.DomUtil.setTransform from leaflet 1.0.0 to work on 0.0.7\n  //------------------------------------------------------------------------------\n  _setTransform: function (el, offset, scale) {\n    var pos = offset || new L.Point(0, 0);\n    el.style[L.DomUtil.TRANSFORM] = (L.Browser.ie3d ? 'translate(' + pos.x + 'px,' + pos.y + 'px)' : 'translate3d(' + pos.x + 'px,' + pos.y + 'px,0)') + (scale ? ' scale(' + scale + ')' : '');\n  },\n  //------------------------------------------------------------------------------\n  _animateZoom: function (e) {\n    var scale = this._map.getZoomScale(e.zoom); // -- different calc of animation zoom  in leaflet 1.0.3 thanks @peterkarabinovic, @jduggan1\n\n\n    var offset = L.Layer ? this._map._latLngBoundsToNewLayerBounds(this._map.getBounds(), e.zoom, e.center).min : this._map._getCenterOffset(e.center)._multiplyBy(-scale).subtract(this._map._getMapPanePos());\n    L.DomUtil.setTransform(this._canvas, offset, scale);\n  }\n});\n\nL.canvasLayer = function () {\n  return new L.CanvasLayer();\n};"]}