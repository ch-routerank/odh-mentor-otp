{"version":3,"sources":["create-otp-reducer.js"],"names":["isTransit","getTransitModes","coreUtils","itinerary","matchLatLon","map","filterProfileOptions","profile","ensureSingleAccessMode","getDefaultQuery","getTripOptionsFromQuery","query","getItem","removeItem","storeItem","storage","getUserTimezone","time","MAX_RECENT_STORAGE","validateInitalState","initialState","config","errors","objectPath","get","push","Error","length","reduce","message","error","getInitialState","userDefinedConfig","initialQuery","defaultConfig","autoPlan","debouncePlanTimeMs","language","transitOperators","realtimeEffectsDisplayThreshold","routingTypes","stopViewer","numberOfDepartures","timeRange","Object","assign","homeTimezone","console","warn","userOverrides","defaults","autoRefreshStopTimes","home","work","trackRecent","expandAdvanced","recentPlaces","favoriteStops","recentSearches","locations","filter","p","currentQuery","l","type","routerId","window","sessionStorage","api","originalPath","path","queryModes","mode","split","includes","m","concat","join","routingType","sort","direction","location","currentPosition","coords","fetching","sessionSearches","nearbyStops","user","searches","transitIndex","stops","trips","useRealtime","activeSearchId","overlay","bikeRental","stations","carRental","parkAndRide","transit","transitive","vehicleRental","zipcar","parking","tnc","etaEstimates","rideEstimates","ui","mobileScreen","MobileScreens","WELCOME_SCREEN","printView","href","indexOf","diagramLeg","createOtpReducer","state","action","searchId","payload","requestId","activeSearch","activeItinerary","pending","$set","activeLeg","activeStep","response","timestamp","$push","nonRealtimeResponse","index","visibleItinerary","locationType","$merge","removeIndex","findIndex","id","splice","$splice","sortedPlaces","a","b","name","lat","lon","stop","icon","alert","s","unshift","duplicateIndex","sortedSearches","initLat","initLon","initZoom","zoom","setItem","elevationPoint","mapPopupLocation","position","$unshift","stopLookup","forEach","stopId","routes","mainPanelContent","MainPanelContent","STOP_VIEWER","viewedStop","viewedTrip","ROUTE_VIEWER","viewedRoute","tripId","stopTimes","geometry","stopTimesLastUpdated","Date","getTime","currentRouteIds","keys","newRoutes","key","res","patterns","routeId","patternId","from","fromData","estimates","estimate","company","productId","estimateTimestamp","rideEstimate","to","rideType","data","mapOverlays","overlays","find","o","visible"],"mappings":"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","sourcesContent":["import clone from 'clone'\nimport update from 'immutability-helper'\nimport isEqual from 'lodash.isequal'\nimport objectPath from 'object-path'\nimport coreUtils from '@opentripplanner/core-utils'\n\nimport { MainPanelContent, MobileScreens } from '../actions/ui'\nimport {getTimestamp} from '../util/state'\n\nconst { isTransit, getTransitModes } = coreUtils.itinerary\nconst { matchLatLon } = coreUtils.map\nconst { filterProfileOptions } = coreUtils.profile\nconst {\n  ensureSingleAccessMode,\n  getDefaultQuery,\n  getTripOptionsFromQuery\n} = coreUtils.query\nconst { getItem, removeItem, storeItem } = coreUtils.storage\nconst { getUserTimezone } = coreUtils.time\n\nconst MAX_RECENT_STORAGE = 5\n\n// TODO: fire planTrip action if default query is complete/error-free\n\n/**\n * Validates the initial state of the store. This is intended to mainly catch\n * configuration issues since a manually edited config file is loaded into the\n * initial state.\n * TODO: mabye it's a better idea to move all of this to a script that can do\n *  JSON Schema validation and other stuff.\n */\nfunction validateInitalState (initialState) {\n  const {config} = initialState\n\n  const errors = []\n\n  // validate that the ArcGIS geocoder isn't used with a persistence strategy of\n  // `localStorage`. ArcGIS requires the use of a paid account to store geocode\n  // results.\n  // See https://developers.arcgis.com/rest/geocode/api-reference/geocoding-free-vs-paid.htm\n  if (\n    objectPath.get(config, 'persistence.enabled') &&\n    objectPath.get(config, 'persistence.strategy') === 'localStorage' &&\n    objectPath.get(config, 'geocoder.type') === 'ARCGIS'\n  ) {\n    errors.push(new Error('Local Storage persistence and ARCGIS geocoder cannot be enabled at the same time!'))\n  }\n\n  if (errors.length > 0) {\n    throw new Error(\n      errors.reduce(\n        (message, error) => {\n          return `${message}\\n- ${error.message}`\n        },\n        'Encountered the following configuration errors:'\n      )\n    )\n  }\n}\n\n/**\n * Create the initial state of otp-react-redux using user-provided config, any\n * items in localStorage and a few defaults.\n */\nexport function getInitialState (userDefinedConfig, initialQuery) {\n  const defaultConfig = {\n    autoPlan: false,\n    debouncePlanTimeMs: 0,\n    language: {},\n    transitOperators: [],\n    realtimeEffectsDisplayThreshold: 120,\n    routingTypes: [],\n    stopViewer: {\n      numberOfDepartures: 3, // per pattern\n      // This is set to 345600 (four days) so that, for example, if it is Friday and\n      // a route does not begin service again until Monday, we are showing its next\n      // departure and it is not entirely excluded from display.\n      timeRange: 345600 // four days in seconds\n    }\n  }\n\n  const config = Object.assign(defaultConfig, userDefinedConfig)\n\n  if (!config.homeTimezone) {\n    config.homeTimezone = getUserTimezone()\n    console.warn(\n      `Config value 'homeTimezone' not configured for this webapp!\\n\n      This value is recommended in order to properly display stop times for\n      users that are not in the timezone that the transit system is in. The\n      detected user timezone of '${config.homeTimezone}' will be used. Hopefully\n      that is the right one...`\n    )\n  }\n\n  // Load user settings from local storage.\n  // TODO: Make this work with settings fetched from alternative storage system\n  //  (e.g., OTP backend middleware containing user profile system).\n  // User overrides determine user's default mode/query parameters.\n  const userOverrides = getItem('defaultQuery', {})\n  // Combine user overrides with default query to get default search settings.\n  const defaults = Object.assign(getDefaultQuery(config), userOverrides)\n  // Whether to auto-refresh stop arrival times in the Fermata.\n  const autoRefreshStopTimes = getItem('autoRefreshStopTimes', true)\n  // User's home and work locations\n  const home = getItem('home')\n  const work = getItem('work')\n  // Whether recent searches and places should be tracked in local storage.\n  const trackRecent = getItem('trackRecent', false)\n  const expandAdvanced = getItem('expandAdvanced', false)\n  // Recent places used in trip plan searches.\n  const recentPlaces = getItem('recent', [])\n  // List of user's favorite stops.\n  const favoriteStops = getItem('favoriteStops', [])\n  // Recent trip plan searches (excluding time/date parameters to avoid complexity).\n  const recentSearches = getItem('recentSearches', [])\n  // Filter valid locations found into locations list.\n  const locations = [home, work].filter(p => p)\n  // TODO: parse and merge URL query params w/ default query\n\n  // populate query by merging any provided query params w/ the default params\n  const currentQuery = Object.assign(defaults, initialQuery)\n  // Add configurable locations to home and work locations\n  if (config.locations) {\n    locations.push(...config.locations.map(l => ({ ...l, type: 'suggested' })))\n  }\n  // Check for alternative routerId in session storage. This is generally used\n  // for testing single GTFS feed OTP graphs that are deployed to feed-specific\n  // routers (e.g., https://otp.server.com/otp/routers/non_default_router).\n  // This routerId session value is initially set by visiting otp-rr\n  // with the path /start/:latLonZoomRouter, which dispatches the SET_ROUTER_ID\n  // action and stores the value in sessionStorage.\n  // Note: this mechanism assumes that the OTP API path is otp/routers/default.\n  const routerId = window.sessionStorage.getItem('routerId')\n  // If routerId is found, update the config.api.path (keep the original config\n  // value at originalPath in case it needs to be reverted.)\n  if (routerId) {\n    config.api.originalPath = userDefinedConfig.api.path\n    config.api.path = `/otp/routers/${routerId}`\n  }\n  let queryModes = currentQuery.mode.split(',')\n\n  // If 'TRANSIT' is included in the mode list, replace it with individual modes\n  if (queryModes.includes('TRANSIT')) {\n    // Isolate the non-transit modes in queryModes\n    queryModes = queryModes.filter(m => !isTransit(m))\n    // Add all possible transit modes\n    queryModes = queryModes.concat(getTransitModes(config))\n    // Stringify and set as OTP 'mode' query param\n    currentQuery.mode = queryModes.join(',')\n  }\n\n  // If we are in 'ITINERARY' mode, ensure that one and only one access mode is selected\n  if (currentQuery.routingType === 'ITINERARY') {\n    queryModes = ensureSingleAccessMode(queryModes)\n  }\n\n  return {\n    config,\n    currentQuery,\n    filter: {\n      filter: 'ALL',\n      sort: {\n        direction: 'ASC',\n        type: 'BEST'\n      }\n    },\n    location: {\n      currentPosition: {\n        error: null,\n        coords: null,\n        fetching: false\n      },\n      sessionSearches: [],\n      nearbyStops: []\n    },\n    user: {\n      autoRefreshStopTimes,\n      // Do not store from/to or date/time in defaults\n      defaults: getTripOptionsFromQuery(defaults),\n      expandAdvanced,\n      favoriteStops,\n      trackRecent,\n      locations,\n      recentPlaces,\n      recentSearches\n    },\n    searches: {},\n    transitIndex: {\n      stops: {},\n      trips: {}\n    },\n    useRealtime: true,\n    activeSearchId: 0,\n    overlay: {\n      bikeRental: {\n        stations: []\n      },\n      carRental: {\n        stations: []\n      },\n      parkAndRide: {\n        // null default value indicates no request for P&R list has been made\n        locations: null\n      },\n      transit: {\n        stops: []\n      },\n      transitive: null,\n      vehicleRental: {\n        stations: []\n      },\n      zipcar: {\n        locations: []\n    },\n    parking: {\n      locations: []\n    }\n    },\n    tnc: {\n      etaEstimates: {},\n      rideEstimates: {}\n    },\n    ui: {\n      mobileScreen: MobileScreens.WELCOME_SCREEN,\n      printView: window.location.href.indexOf('/print/') !== -1,\n      diagramLeg: null\n    }\n  }\n}\n\nfunction createOtpReducer (config, initialQuery) {\n  const initialState = getInitialState(config, initialQuery)\n  // validate the inital state\n  validateInitalState(initialState)\n\n  return (state = initialState, action) => {\n    const searchId = action.payload && action.payload.searchId\n    const requestId = action.payload && action.payload.requestId\n    const activeSearch = state.searches[searchId]\n    switch (action.type) {\n      case 'ROUTING_REQUEST':\n        const { activeItinerary, pending } = action.payload\n        return update(state, {\n          searches: {\n            [searchId]: {\n              $set: {\n                activeItinerary,\n                activeLeg: null,\n                activeStep: null,\n                pending,\n                // FIXME: get query from action payload?\n                query: clone(state.currentQuery),\n                response: [],\n                timestamp: getTimestamp()\n              }\n            }\n          },\n          activeSearchId: { $set: searchId }\n        })\n      case 'ROUTING_ERROR':\n        return update(state, {\n          searches: {\n            [searchId]: {\n              response: {\n                $push: [{\n                  error: action.payload.error,\n                  requestId\n                }]\n              },\n              pending: { $set: activeSearch.pending - 1 }\n            }\n          }\n        })\n      case 'ROUTING_RESPONSE':\n        const response = (state.currentQuery.routingType === 'PROFILE')\n          ? filterProfileOptions(action.payload.response)\n          : action.payload.response\n        response.requestId = requestId\n        return update(state, {\n          searches: {\n            [searchId]: {\n              response: { $push: [response] },\n              pending: { $set: activeSearch.pending - 1 }\n            }\n          },\n          ui: {\n            diagramLeg: { $set: null }\n          }\n        })\n      case 'NON_REALTIME_ROUTING_RESPONSE':\n        return update(state, {\n          searches: {\n            [searchId]: {\n              nonRealtimeResponse: { $set: action.payload.response }\n            }\n          }\n        })\n      case 'BIKE_RENTAL_REQUEST':\n        return update(state, {\n          overlay: {\n            bikeRental: {\n              pending: { $set: true },\n              error: { $set: null }\n            }\n          }\n        })\n      case 'BIKE_RENTAL_ERROR':\n        return update(state, {\n          overlay: {\n            bikeRental: {\n              pending: { $set: false },\n              error: { $set: action.payload }\n            }\n          }\n        })\n      case 'BIKE_RENTAL_RESPONSE':\n        return update(state, {\n          overlay: {\n            bikeRental: {\n              stations: { $set: action.payload.stations },\n              pending: { $set: false }\n            }\n          }\n        })\n      case 'CAR_RENTAL_ERROR':\n        return update(state, {\n          overlay: {\n            carRental: {\n              pending: { $set: false },\n              error: { $set: action.payload }\n            }\n          }\n        })\n      case 'CAR_RENTAL_RESPONSE':\n        return update(state, {\n          overlay: {\n            carRental: {\n              stations: { $set: action.payload.stations },\n              pending: { $set: false }\n            }\n          }\n        })\n      case 'VEHICLE_RENTAL_ERROR':\n        return update(state, {\n          overlay: {\n            vehicleRental: {\n              pending: { $set: false },\n              error: { $set: action.payload }\n            }\n          }\n        })\n      case 'VEHICLE_RENTAL_RESPONSE':\n        return update(state, {\n          overlay: {\n            vehicleRental: {\n              stations: { $set: action.payload.stations },\n              pending: { $set: false }\n            }\n          }\n        })\n      case 'SET_USE_REALTIME_RESPONSE':\n        return update(state, {\n          useRealtime: { $set: action.payload.useRealtime }\n        })\n      case 'SET_ACTIVE_ITINERARY':\n        if (state.activeSearchId !== null) {\n          return update(state, {\n            searches: {\n              [state.activeSearchId]: {\n                activeItinerary: { $set: action.payload.index },\n                activeLeg: { $set: null },\n                activeStep: { $set: null }\n              }\n            }\n          })\n        }\n        return state\n      case 'SET_VISIBLE_ITINERARY':\n        if (state.activeSearchId !== null) {\n          return update(state, {\n            searches: {\n              [state.activeSearchId]: {\n                visibleItinerary: { $set: action.payload.index }\n              }\n            }\n          })\n        }\n        return state\n      case 'SET_ACTIVE_LEG':\n        if (state.activeSearchId !== null) {\n          return update(state, {\n            searches: {\n              [state.activeSearchId]: {\n                activeLeg: { $set: action.payload.index },\n                activeStep: { $set: null }\n              }\n            }\n          })\n        }\n        return state\n      case 'SET_ACTIVE_STEP':\n        if (state.activeSearchId !== null) {\n          return update(state, {\n            searches: {\n              [state.activeSearchId]: {\n                activeStep: { $set: action.payload.index }\n              }\n            }\n          })\n        }\n        return state\n      case 'SET_LOCATION':\n        return update(state, {\n          currentQuery: {\n            [action.payload.locationType]: { $set: action.payload.location }\n          }\n        })\n      case 'CLEAR_LOCATION':\n        return update(state, {\n          currentQuery: { [action.payload.locationType]: { $set: null } }\n        })\n\n      case 'SET_QUERY_PARAM':\n        return update(state, { currentQuery: { $merge: action.payload } })\n\n      case 'CLEAR_ACTIVE_SEARCH':\n        return update(state, { activeSearchId: { $set: null } })\n      case 'SET_ACTIVE_SEARCH':\n        return update(state, { activeSearchId: { $set: action.payload } })\n      case 'CLEAR_DEFAULT_SETTINGS':\n        removeItem('defaultQuery')\n        return update(state, { user: { defaults: { $set: null } } })\n      case 'STORE_DEFAULT_SETTINGS':\n        storeItem('defaultQuery', action.payload)\n        return update(state, { user: { defaults: { $set: action.payload } } })\n      case 'FORGET_PLACE': {\n        // Payload is the place ID.\n        // Recent place IDs contain the string literal 'recent'.\n        if (action.payload.indexOf('recent') !== -1) {\n          const recentPlaces = clone(state.user.recentPlaces)\n          // Remove recent from list of recent places\n          const removeIndex = recentPlaces.findIndex(l => l.id === action.payload)\n          recentPlaces.splice(removeIndex, 1)\n          storeItem('recent', recentPlaces)\n          return removeIndex !== -1\n            ? update(state, { user: { recentPlaces: { $splice: [[removeIndex, 1]] } } })\n            : state\n        } else {\n          const locations = clone(state.user.locations)\n          const removeIndex = locations.findIndex(l => l.id === action.payload)\n          removeItem(action.payload)\n          return removeIndex !== -1\n            ? update(state, { user: { locations: { $splice: [[removeIndex, 1]] } } })\n            : state\n        }\n      }\n      case 'REMEMBER_PLACE': {\n        const { location, type } = action.payload\n        switch (type) {\n          case 'recent': {\n            const recentPlaces = clone(state.user.recentPlaces)\n            const index = recentPlaces.findIndex(l => matchLatLon(l, location))\n            // Replace recent place if duplicate found or add to list.\n            if (index !== -1) recentPlaces.splice(index, 1, location)\n            else recentPlaces.push(location)\n            const sortedPlaces = recentPlaces.sort((a, b) => b.timestamp - a.timestamp)\n            // Only keep up to 5 recent locations\n            // FIXME: Check for duplicates\n            if (recentPlaces.length >= MAX_RECENT_STORAGE) {\n              sortedPlaces.splice(MAX_RECENT_STORAGE)\n            }\n            storeItem('recent', recentPlaces)\n            return update(state, { user: { recentPlaces: { $set: sortedPlaces } } })\n          }\n          default: {\n            const locations = clone(state.user.locations)\n            // Determine if location type (e.g., home or work) already exists in list\n            const index = locations.findIndex(l => l.type === type)\n            if (index !== -1) locations.splice(index, 1, location)\n            else locations.push(location)\n            storeItem(type, location)\n            return update(state, { user: { locations: { $set: locations } } })\n          }\n        }\n      }\n      case 'FORGET_STOP': {\n        // Payload is the stop ID.\n        const favoriteStops = clone(state.user.favoriteStops)\n        // Remove stop from favorites\n        const removeIndex = favoriteStops.findIndex(l => l.id === action.payload)\n        favoriteStops.splice(removeIndex, 1)\n        storeItem('favoriteStops', favoriteStops)\n        return removeIndex !== -1\n          ? update(state, { user: { favoriteStops: { $splice: [[removeIndex, 1]] } } })\n          : state\n      }\n      case 'REMEMBER_STOP': {\n        // Payload is stop data. We want to avoid saving other attributes that\n        // might be contained there (like lists of patterns).\n        const { id, name, lat, lon } = action.payload\n        const stop = {\n          type: 'stop',\n          icon: 'bus',\n          id,\n          name,\n          lat,\n          lon\n        }\n        const favoriteStops = clone(state.user.favoriteStops)\n        if (favoriteStops.length >= MAX_RECENT_STORAGE) {\n          window.alert(`Cannot save more than ${MAX_RECENT_STORAGE} stops. Remove one before adding more.`)\n          return state\n        }\n        const index = favoriteStops.findIndex(s => s.id === stop.id)\n        // Do nothing if duplicate stop found.\n        if (index !== -1) {\n          console.warn(`Stop with id ${stop.id} already exists in favorites.`)\n          return state\n        } else {\n          favoriteStops.unshift(stop)\n        }\n        storeItem('favoriteStops', favoriteStops)\n        return update(state, { user: { favoriteStops: { $set: favoriteStops } } })\n      }\n      // FIXME: set up action\n      case 'TOGGLE_ADVANCED_OPTIONS':\n        storeItem('expandAdvanced', action.payload)\n        if (!action.payload) removeItem('expandAdvanced')\n        return update(state, { user: {\n          expandAdvanced: { $set: action.payload }\n        } })\n      case 'TOGGLE_TRACKING': {\n        storeItem('trackRecent', action.payload)\n        let recentPlaces = clone(state.user.recentPlaces)\n        let recentSearches = clone(state.user.recentSearches)\n        if (!action.payload) {\n          // If user disables tracking, remove recent searches and locations.\n          recentPlaces = []\n          recentSearches = []\n          removeItem('recent')\n          removeItem('recentSearches')\n        }\n        return update(state, { user: {\n          trackRecent: { $set: action.payload },\n          recentPlaces: { $set: recentPlaces },\n          recentSearches: { $set: recentSearches }\n        } })\n      }\n      case 'REMEMBER_SEARCH':\n        const searches = clone(state.user.recentSearches)\n        const duplicateIndex = searches.findIndex(s => isEqual(s.query, action.payload.query))\n        // Overwrite duplicate search (so that new timestamp is stored).\n        if (duplicateIndex !== -1) searches[duplicateIndex] = action.payload\n        else searches.unshift(action.payload)\n        const sortedSearches = searches.sort((a, b) => b.timestamp - a.timestamp)\n        // Ensure recent searches do not extend beyong MAX_RECENT_STORAGE\n        if (sortedSearches.length >= MAX_RECENT_STORAGE) {\n          sortedSearches.splice(MAX_RECENT_STORAGE)\n        }\n        storeItem('recentSearches', sortedSearches)\n        return update(state, { user: { searches: { $set: sortedSearches } } })\n      case 'FORGET_SEARCH': {\n        const recentSearches = clone(state.user.recentSearches)\n        const index = recentSearches.findIndex(l => l.id === action.payload)\n        // Remove item from list of recent searches\n        recentSearches.splice(index, 1)\n        storeItem('recentSearches', recentSearches)\n        return index !== -1\n          ? update(state, { user: { recentSearches: { $splice: [[index, 1]] } } })\n          : state\n      }\n      case 'SET_AUTOPLAN':\n        return update(state, {\n          config: { autoPlan: { $set: action.payload.autoPlan } }\n        })\n      case 'SET_MAP_CENTER':\n        return update(state, {\n          config: {\n            map: {\n              initLat: { $set: action.payload.lat },\n              initLon: { $set: action.payload.lon }\n            }\n          }\n        })\n      case 'SET_MAP_ZOOM':\n        return update(state, {\n          config: {\n            map: {\n              initZoom: { $set: action.payload.zoom }\n            }\n          }\n        })\n      case 'SET_ROUTER_ID':\n        const routerId = action.payload\n        // Store original path value in originalPath variable.\n        const originalPath = config.api.originalPath || config.api.path || '/otp/routers/default'\n        const path = routerId\n          ? `/otp/routers/${routerId}`\n          // If routerId is null, revert to the original config's API path (or\n          // the standard path if that is not found).\n          : originalPath\n        // Store routerId in session storage (persists through page reloads but\n        // not when a new tab/window is opened).\n        if (routerId) window.sessionStorage.setItem('routerId', routerId)\n        else window.sessionStorage.removeItem('routerId')\n        return update(state, {\n          config: {\n            api: {\n              path: { $set: path },\n              originalPath: { $set: originalPath }\n            }\n          }\n        })\n      case 'SET_LEG_DIAGRAM':\n        return update(state, {\n          ui: {\n            diagramLeg: { $set: action.payload }\n          }\n        })\n      case 'SET_ELEVATION_POINT':\n        return update(state, {\n          ui: {\n            elevationPoint: { $set: action.payload }\n          }\n        })\n      case 'SET_MAP_POPUP_LOCATION':\n        return update(state, {\n          ui: {\n            mapPopupLocation: { $set: action.payload.location }\n          }\n        })\n      case 'POSITION_FETCHING':\n        return update(state, {\n          location: {\n            currentPosition: { $merge: { fetching: action.payload.type } }\n          }\n        })\n      case 'POSITION_ERROR':\n        return update(state, {\n          location: { currentPosition: { $set: action.payload } }\n        })\n      case 'POSITION_RESPONSE':\n        return update(state, {\n          location: { currentPosition: { $set: action.payload.position } }\n        })\n      case 'ADD_LOCATION_SEARCH':\n        return update(state, {\n          location: { sessionSearches: { $unshift: [action.payload.location] } }\n        })\n\n      case 'NEARBY_STOPS_RESPONSE':\n        const stopLookup = {}\n        action.payload.stops.forEach(s => {\n          stopLookup[s.id] = s\n        })\n        return update(state, {\n          location: {\n            nearbyStops: { $set: action.payload.stops.map(s => s.id) }\n          },\n          transitIndex: { stops: { $merge: stopLookup } }\n        })\n      case 'STOPS_WITHIN_BBOX_RESPONSE':\n        return update(state, {\n          overlay: {\n            transit: {\n              stops: { $set: action.payload.stops },\n              pending: { $set: false }\n            }\n          }\n        })\n      case 'CLEAR_STOPS_OVERLAY':\n        return update(state, {\n          overlay: {\n            transit: {\n              stops: { $set: [] },\n              pending: { $set: false }\n            }\n          }\n        })\n      case 'ROUTES_AT_STOP_RESPONSE':\n        return update(state, {\n          transitIndex: {\n            stops: {\n              [action.payload.stopId]: {\n                routes: { $set: action.payload.routes }\n              }\n            }\n          }\n        })\n      case 'SET_MOBILE_SCREEN':\n        return update(state, { ui: { mobileScreen: { $set: action.payload } } })\n      case 'SET_MAIN_PANEL_CONTENT':\n        return update(state, {\n          ui: {\n            mainPanelContent: { $set: action.payload }\n          }\n        })\n      case 'SET_VIEWED_STOP':\n        if (action.payload) {\n          // If setting to a stop (not null), also set main panel.\n          return update(state, { ui: {\n            mainPanelContent: { $set: MainPanelContent.STOP_VIEWER },\n            viewedStop: { $set: action.payload }\n          } })\n        } else {\n          // Otherwise, just replace viewed stop with null\n          return update(state, { ui: { viewedStop: { $set: action.payload } } })\n        }\n      case 'CLEAR_VIEWED_STOP':\n        return update(state, { ui: { viewedStop: { $set: null } } })\n\n      case 'SET_VIEWED_TRIP':\n        return update(state, { ui: { viewedTrip: { $set: action.payload } } })\n      case 'CLEAR_VIEWED_TRIP':\n        return update(state, { ui: { viewedTrip: { $set: null } } })\n\n      case 'SET_VIEWED_ROUTE':\n        if (action.payload) {\n          // If setting to a route (not null), also set main panel.\n          return update(state, { ui: {\n            mainPanelContent: { $set: MainPanelContent.ROUTE_VIEWER },\n            viewedRoute: { $set: action.payload }\n          } })\n        } else {\n          // Otherwise, just replace viewed route with null\n          return update(state, { ui: { viewedRoute: { $set: action.payload } } })\n        }\n      case 'FIND_STOP_RESPONSE':\n        return update(state, {\n          transitIndex: {\n            stops: { [action.payload.id]: { $set: action.payload } }\n          }\n        })\n      case 'FIND_TRIP_RESPONSE':\n        return update(state, {\n          transitIndex: {\n            trips: { [action.payload.id]: { $set: action.payload } }\n          }\n        })\n      case 'FIND_STOPS_FOR_TRIP_RESPONSE':\n        return update(state, {\n          transitIndex: {\n            trips: {\n              [action.payload.tripId]: { stops: { $set: action.payload.stops } }\n            }\n          }\n        })\n      case 'FIND_STOP_TIMES_FOR_TRIP_RESPONSE':\n        return update(state, {\n          transitIndex: {\n            trips: {\n              [action.payload.tripId]: {\n                stopTimes: { $set: action.payload.stopTimes }\n              }\n            }\n          }\n        })\n      case 'FIND_GEOMETRY_FOR_TRIP_RESPONSE':\n        return update(state, {\n          transitIndex: {\n            trips: {\n              [action.payload.tripId]: {\n                geometry: { $set: action.payload.geometry }\n              }\n            }\n          }\n        })\n      case 'FIND_STOP_TIMES_FOR_STOP_RESPONSE':\n        return update(state, {\n          transitIndex: {\n            stops: {\n              [action.payload.stopId]: {\n                stopTimes: { $set: action.payload.stopTimes },\n                stopTimesLastUpdated: { $set: new Date().getTime() }\n              }\n            }\n          }\n        })\n      case 'TOGGLE_AUTO_REFRESH':\n        storeItem('autoRefreshStopTimes', action.payload)\n        return update(state, { user: { autoRefreshStopTimes: { $set: action.payload } } })\n\n      case 'FIND_ROUTES_RESPONSE':\n        // If routes is undefined, initialize it w/ the full payload\n        if (!state.transitIndex.routes) {\n          return update(state, {\n            transitIndex: { routes: { $set: action.payload } }\n          })\n        }\n        // Otherwise, merge in only the routes not already defined\n        const currentRouteIds = Object.keys(state.transitIndex.routes)\n        const newRoutes = Object.keys(action.payload)\n          .filter(key => !currentRouteIds.includes(key))\n          .reduce((res, key) => Object.assign(res, { [key]: action.payload[key] }), {})\n        return update(state, {\n          transitIndex: { routes: { $merge: newRoutes } }\n        })\n      case 'FIND_ROUTE_RESPONSE':\n        // If routes is undefined, initialize it w/ this route only\n        if (!state.transitIndex.routes) {\n          return update(state, {\n            transitIndex: { routes: { $set: { [action.payload.id]: action.payload } } }\n          })\n        }\n        // Otherwise, overwrite only this route\n        return update(state, {\n          transitIndex: {\n            routes: { [action.payload.id]: { $set: action.payload } }\n          }\n        })\n      case 'FIND_PATTERNS_FOR_ROUTE_RESPONSE':\n        const { patterns, routeId } = action.payload\n        // If routes is undefined, initialize it w/ this route only\n        if (!state.transitIndex.routes) {\n          return update(state, {\n            transitIndex: { routes: { $set: { [routeId]: { patterns } } } }\n          })\n        }\n        // Otherwise, overwrite only this route\n        return update(state, {\n          transitIndex: {\n            routes: { [routeId]: { patterns: { $set: patterns } } }\n          }\n        })\n      case 'FIND_GEOMETRY_FOR_PATTERN_RESPONSE':\n        return update(state, {\n          transitIndex: {\n            routes: {\n              [action.payload.routeId]: {\n                patterns: {\n                  [action.payload.patternId]: {\n                    geometry: { $set: action.payload.geometry }\n                  }\n                }\n              }\n            }\n          }\n        })\n      case 'TNC_ETA_RESPONSE':\n        return update(state, {\n          tnc: {\n            etaEstimates: {\n              [action.payload.from]: fromData => {\n                fromData = Object.assign({}, fromData)\n                const estimates = action.payload.estimates || []\n                estimates.forEach(estimate => {\n                  if (!fromData[estimate.company]) {\n                    fromData[estimate.company] = {}\n                  }\n                  fromData[estimate.company][estimate.productId] = Object.assign(\n                    {\n                      estimateTimestamp: new Date()\n                    },\n                    estimate\n                  )\n                })\n                return fromData\n              }\n            }\n          }\n        })\n      case 'TNC_RIDE_RESPONSE':\n        return update(state, {\n          tnc: {\n            rideEstimates: {\n              [action.payload.from]: fromData => {\n                fromData = Object.assign({}, fromData)\n                const { company, rideEstimate, to } = action.payload\n                if (!rideEstimate) {\n                  return fromData\n                }\n                if (!fromData[to]) {\n                  fromData[to] = {}\n                }\n                if (!fromData[to][company]) {\n                  fromData[to][company] = {}\n                }\n                fromData[to][company][rideEstimate.rideType] = Object.assign(\n                  {\n                    estimateTimestamp: new Date()\n                  },\n                  rideEstimate\n                )\n                return fromData\n              }\n            }\n          }\n        })\n\n      case 'PARK_AND_RIDE_RESPONSE':\n        return update(state, {\n          overlay: {\n            parkAndRide: {\n              locations: { $set: action.payload },\n              pending: { $set: false }\n            }\n          }\n        })\n\n      // TODO: can this be broken out into a separate module?\n      case 'ZIPCAR_LOCATIONS_RESPONSE':\n        return update(state, {\n          overlay: {\n            zipcar: {\n              locations: { $set: action.payload.locations },\n              pending: { $set: false }\n            }\n          }\n        })\n\n        case 'PARKING_LOCATIONS_RESPONSE':\n          return update(state, {\n            overlay: {\n              parking: {\n                locations: { $set: action.payload.data.stations },\n                pending: { $set: false }\n              }\n            }\n          })\n      case 'UPDATE_OVERLAY_VISIBILITY':\n        const mapOverlays = clone(state.config.map.overlays)\n        for (let key in action.payload) {\n          const overlay = mapOverlays.find(o => o.name === key)\n          overlay.visible = action.payload[key]\n        }\n        return update(state,\n          { config: { map: { overlays: { $set: mapOverlays } } } }\n        )\n      default:\n        return state\n      case 'UPDATE_ITINERARY_FILTER':\n        return update(state,\n          { filter: { $set: action.payload } }\n        )\n    }\n  }\n}\n\nexport default createOtpReducer\n"]}