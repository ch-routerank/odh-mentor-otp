{"version":3,"sources":["call-taker-panel.js"],"names":["StyledSubmodeSelector","SubmodeSelector","TripFormClasses","Row","ModeButton","Button","InlineRow","modeButtonButtonCss","departureOptions","value","children","modeOptions","metersToMiles","meters","Math","round","milesToMeters","miles","CallTakerPanel","props","currentQuery","routingQuery","issues","push","length","window","alert","join","options","bannedRoutes","map","o","setQueryParam","mode","isTransit","isBike","result","index","intermediatePlaces","undefined","splice","location","evt","target","transitIsSelected","indexOf","accessMode","transitModes","state","modes","m","newModes","setState","expandAdvanced","keyCode","preventDefault","_planTrip","activeSearch","itineraryFooter","LegIcon","mainPanelContent","mobile","ModeIcon","routes","showUserSettings","showPlanTripButton","departArrive","date","from","time","to","actionText","advancedSearchStyle","zIndex","background","position","right","left","padding","display","maxPlacesDefined","addIntermediateDisabled","top","bottom","paddingBottom","overflow","Array","isArray","place","i","_removePlace","_addPlace","marginBottom","marginLeft","height","_handleFormKeyDown","_setMode","modeToOptionValue","_onHideAdvancedClick","findRoutes","flexDirection","Component","CallTakerAdvancedOptions","preferredRoutes","Option","getRouteList","find","distanceInMeters","changedMode","allModes","split","maxWalkDistance","key","routesParam","idList","routeOptions","filter","id","label","route","longName","shortName","replace","nextProps","Object","values","routeToOption","maxBikeDistance","modeObj","modeStr","selected","text","title","unitsString","alignItems","justifyContent","fontWeight","_setMaxWalkDistance","getDistanceStep","marginRight","width","_setMaxBikeDistance","_onSubModeChange","_isPreferredRouteOptionDisabled","_setPreferredRoutes","_isBannedRouteOptionDisabled","_setBannedRoutes","TIME_FORMATS","format","DateTimeOptions","OTP_API_DATE_FORMAT","OTP_API_TIME_FORMAT","timeInput","console","log","startOf","leaveNow","dateTime","cleanDate","cleanTime","_setDepartArrive","onKeyDown","handleTimeChange","border","outline","handleDateChange","mapStateToProps","ownProps","otp","user","ui","config","transitIndex","mapDispatchToProps","apiActions","formActions"],"mappings":"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","sourcesContent":["import {\n  OTP_API_DATE_FORMAT,\n  OTP_API_TIME_FORMAT\n} from '@opentripplanner/core-utils/lib/time'\nimport { hasBike, hasTransit } from '@opentripplanner/core-utils/lib/itinerary'\nimport { storeItem } from '@opentripplanner/core-utils/lib/storage'\nimport {SubmodeSelector} from '@opentripplanner/trip-form'\nimport * as TripFormClasses from '@opentripplanner/trip-form/lib/styled'\nimport moment from 'moment'\nimport React, { Component } from 'react'\nimport { Button } from 'react-bootstrap'\nimport { connect } from 'react-redux'\nimport Select from 'react-select'\nimport styled from 'styled-components'\n\nimport * as apiActions from '../../actions/api'\nimport * as formActions from '../../actions/form'\nimport IntermediatePlace from '../form/intermediate-place-field'\nimport LocationField from '../form/connected-location-field'\nimport { modeButtonButtonCss } from '../form/styled'\nimport SwitchButton from '../form/switch-button'\nimport UserSettings from '../form/user-settings'\nimport NarrativeItineraries from '../narrative/narrative-itineraries'\nimport { hasValidLocation, getActiveSearch, getShowUserSettings } from '../../util/state'\nimport ViewerContainer from '../viewers/viewer-container'\n\n// FIXME: move to styled.js?\nexport const StyledSubmodeSelector = styled(SubmodeSelector)`\n  ${TripFormClasses.SubmodeSelector.Row} {\n    > * {\n      padding: 3px 5px 3px 0px;\n    }\n    > :last-child {\n      padding-right: 0px;\n    }\n    ${TripFormClasses.ModeButton.Button} {\n      padding: 6px 12px;\n    }\n    svg,\n    img {\n      margin-left: 0px;\n    }\n  }\n  ${TripFormClasses.SubmodeSelector.InlineRow} {\n    margin: -3px 0px;\n  }\n\n  ${TripFormClasses.SubmodeSelector} {\n      ${modeButtonButtonCss}\n  }\n`\n\nconst departureOptions = [\n  {\n    // Default option.\n    value: 'NOW',\n    children: 'Now'\n  },\n  {\n    value: 'DEPART',\n    children: 'Depart at'\n  },\n  {\n    value: 'ARRIVE',\n    children: 'Arrive by'\n  }\n]\n\nconst modeOptions = [\n  {\n    // Default option.\n    value: 'TRANSIT',\n    children: 'Transit'\n  },\n  {\n    value: 'WALK',\n    children: 'A Piedi'\n  },\n  {\n    value: 'BICYCLE',\n    children: 'Bike only'\n  },\n  {\n    value: 'BICYCLE,TRANSIT',\n    children: 'Bike to transit'\n  }\n]\n\nconst metersToMiles = meters => Math.round(meters * 0.000621371 * 100) / 100\nconst milesToMeters = miles => miles / 0.000621371\n\n/**\n * This is the main panel/sidebar for the Call Taker/Field Trip module. It\n * currently also serves as the main panel for the FDOT RMCE trip comparison view\n * which depends on the BATCH trip planning mode.\n */\nclass CallTakerPanel extends Component {\n  constructor (props) {\n    super(props)\n    this.state = {\n      expandAdvanced: props.expandAdvanced,\n      transitModes: props.modes.transitModes.map(m => m.mode)\n    }\n  }\n\n  _planTrip = () => {\n    const {currentQuery, routingQuery} = this.props\n    const issues = []\n    if (!hasValidLocation(currentQuery, 'from')) issues.push('from')\n    if (!hasValidLocation(currentQuery, 'to')) issues.push('to')\n    if (issues.length > 0) {\n      // TODO: replace with less obtrusive validation.\n      window.alert(`Please define the following fields to Viaggia: ${issues.join(', ')}`)\n      return\n    }\n    routingQuery()\n  }\n\n  _setBannedRoutes = options => {\n    const bannedRoutes = options ? options.map(o => o.value).join(',') : ''\n    this.props.setQueryParam({ bannedRoutes })\n  }\n\n  modeToOptionValue = mode => {\n    const isTransit = hasTransit(mode)\n    const isBike = hasBike(mode)\n    if (isTransit && isBike) return 'BICYCLE,TRANSIT'\n    else if (isTransit) return 'TRANSIT'\n    // Currently handles bicycle\n    else return mode\n  }\n\n  _addPlace = (result, index) => {\n    const intermediatePlaces = [...this.props.currentQuery.intermediatePlaces] || []\n    if (result && index !== undefined) {\n      // If adding an actual intermediate place with location. Overwrite the\n      // placeholder with the new value.\n      intermediatePlaces.splice(index, 1, result.location)\n    } else {\n      // Otherwise, we're just adding a dummy place.\n      intermediatePlaces.push({})\n    }\n    this.props.setQueryParam({intermediatePlaces})\n  }\n\n  _removePlace = ({index}) => {\n    const intermediatePlaces = [...this.props.currentQuery.intermediatePlaces] || []\n    intermediatePlaces.splice(index, 1)\n    this.props.setQueryParam({intermediatePlaces})\n  }\n\n  _setMode = evt => {\n    const {value: mode} = evt.target\n    const transitIsSelected = mode.indexOf('TRANSIT') !== -1\n    if (transitIsSelected) {\n      // Collect transit modes and selected access mode.\n      const accessMode = mode === 'TRANSIT' ? 'WALK' : 'BICYCLE'\n      // If no transit is selected, selected all available. Otherwise, default\n      // to state.\n      const transitModes = this.state.transitModes.length > 0\n        ? this.state.transitModes\n        : this.props.modes.transitModes.map(m => m.mode)\n      const newModes = [accessMode, ...transitModes].join(',')\n      this.setState({transitModes})\n      this.props.setQueryParam({ mode: newModes })\n    } else {\n      this.props.setQueryParam({ mode })\n    }\n  }\n\n  _onHideAdvancedClick = () => {\n    const expandAdvanced = !this.state.expandAdvanced\n    // FIXME move logic to action\n    storeItem('expandAdvanced', expandAdvanced)\n    this.setState({expandAdvanced})\n  }\n\n  /**\n   * Key down listener that will submit a Pianifica Viaggio query when Enter is pressed.\n   * This listener can be passed to constituent form elements for easy\n   * keyboard-only operation of the trip planning form. Note: it generally should\n   * not be passed to buttons or other elements that natively rely on the Enter\n   * key.\n   *\n   * FIXME: Should we use a proper submit button instead?\n   */\n  _handleFormKeyDown = (evt) => {\n    switch (evt.keyCode) {\n      case 13: // Enter\n        evt.preventDefault()\n        // Submit routing query.\n        this._planTrip()\n        break\n      default:\n        // Do nothing.\n        break\n    }\n  }\n\n  render () {\n    const {\n      activeSearch,\n      currentQuery,\n      itineraryFooter,\n      LegIcon,\n      mainPanelContent,\n      mobile,\n      modes,\n      ModeIcon,\n      routes,\n      setQueryParam,\n      showUserSettings\n    } = this.props\n    // FIXME: Remove showPlanTripButton\n    const showPlanTripButton = mainPanelContent === 'EDIT_DATETIME' ||\n      mainPanelContent === 'EDIT_SETTINGS'\n    // const mostRecentQuery = activeSearch ? activeSearch.query : null\n    // const planDisabled = isEqual(currentQuery, mostRecentQuery)\n    const {\n      departArrive,\n      date,\n      from,\n      intermediatePlaces,\n      mode,\n      time,\n      to\n    } = currentQuery\n    const actionText = mobile ? 'tappa' : 'clicca'\n    const {expandAdvanced} = this.state\n    const advancedSearchStyle = {\n      zIndex: 99999,\n      background: 'white',\n      position: 'absolute',\n      right: '0px',\n      left: '0px',\n      padding: '0px 8px 5px',\n      display: expandAdvanced ? 'none' : undefined\n    }\n    // Only permit adding intermediate place if from/to is defined.\n    const maxPlacesDefined = intermediatePlaces.length >= 3\n    const addIntermediateDisabled = !from || !to || maxPlacesDefined\n    return (\n      <ViewerContainer>\n        {/* FIXME: should this be a styled component */}\n        <div className='main-panel' style={{\n          position: 'absolute',\n          top: 0,\n          left: 0,\n          right: 0,\n          bottom: showPlanTripButton ? 55 : 0,\n          paddingBottom: 15,\n          overflow: 'hidden',\n          padding: '10px'\n        }}>\n          <div className='form'>\n            <LocationField\n              inputPlaceholder={`Inserisci partenza o ${actionText} su mappa...`}\n              locationType='from'\n              showClearButton\n            />\n            {Array.isArray(intermediatePlaces) && intermediatePlaces.map((place, i) => {\n              return (\n                <IntermediatePlace\n                  key={i}\n                  index={i}\n                  location={place}\n                  onLocationCleared={this._removePlace}\n                  // FIXME: function def\n                  onLocationSelected={result => this._addPlace(result, i)}\n                  // FIXME: allow intermediate location type.\n                  locationType='to'\n                  inputPlaceholder={`Enter intermediate destination`}\n                  showClearButton={!mobile}\n                />\n              )\n            })}\n            <LocationField\n              inputPlaceholder={`Inserisci destinazione o ${actionText} su mappa...`}\n              locationType='to'\n              showClearButton={!mobile}\n            />\n            <div\n              // FIXME\n              style={{\n                top: '20px'\n              }}\n              className='switch-button-container'>\n              <SwitchButton content={<i className='fa fa-exchange fa-rotate-90' />} />\n            </div>\n            <button\n              className='clear-button-formatting'\n              style={{marginBottom: '5px', marginLeft: '10px'}}\n              disabled={addIntermediateDisabled}\n              onClick={this._addPlace}>\n              <i className='fa fa-plus-circle' />{' '}\n              {maxPlacesDefined\n                ? 'Maximum intermediate places reached'\n                : addIntermediateDisabled\n                  ? 'Define origin/destination to add intermediate places'\n                  : 'Add place'\n              }\n            </button>\n            <div className='search-options' style={{height: '30px'}}>\n              <DateTimeOptions\n                date={date}\n                onKeyDown={this._handleFormKeyDown}\n                departArrive={departArrive}\n                setQueryParam={setQueryParam}\n                time={time} />\n              <select\n                onBlur={this._setMode}\n                onKeyDown={this._handleFormKeyDown}\n                value={this.modeToOptionValue(mode)}\n                style={{position: 'absolute', right: '50px'}}\n                onChange={this._setMode}>\n                {modeOptions.map(o => (\n                  <option key={o.value} {...o} />\n                ))}\n              </select>\n              <Button\n                bsStyle='default'\n                bsSize='small'\n                onClick={this._planTrip}\n                style={{\n                  position: 'absolute',\n                  right: '0px'\n                }} >\n                Plan\n              </Button>\n            </div>\n            <div className='advanced-search-options-container'>\n              <Button\n                className='hide-button clear-button-formatting'\n                onClick={this._onHideAdvancedClick}>\n                <i className={`fa fa-caret-${expandAdvanced ? 'up' : 'down'}`} /> Advanced options\n              </Button>\n              <div className='advanced-search-options' style={advancedSearchStyle}>\n                <CallTakerAdvancedOptions\n                  modes={modes}\n                  ModeIcon={ModeIcon}\n                  routes={routes}\n                  findRoutes={this.props.findRoutes}\n                  setQueryParam={setQueryParam}\n                  currentQuery={currentQuery} />\n              </div>\n            </div>\n          </div>\n          {!activeSearch && !showPlanTripButton && showUserSettings &&\n            <UserSettings />\n          }\n          <div className='desktop-narrative-container'>\n            <NarrativeItineraries\n              containerStyle={{\n                display: 'flex',\n                flexDirection: 'column',\n                position: 'absolute',\n                // FIXME: This top pixel value can be variable dependent on\n                // height of the form above. It may need to be specified differently\n                top: 193 + intermediatePlaces.length * 45,\n                right: '0',\n                left: '0',\n                bottom: '0'\n              }}\n              itineraryFooter={itineraryFooter}\n              LegIcon={LegIcon}\n            />\n          </div>\n        </div>\n      </ViewerContainer>\n    )\n  }\n}\n\nclass CallTakerAdvancedOptions extends Component {\n  constructor (props) {\n    super(props)\n    this.state = {\n      expandAdvanced: props.expandAdvanced,\n      routeOptions: [],\n      transitModes: props.modes.transitModes.map(m => m.mode)\n    }\n  }\n\n  componentWillMount () {\n    // Fetch routes for banned/preferred routes selectors.\n    this.props.findRoutes()\n  }\n\n  componentWillReceiveProps (nextProps) {\n    const {routes} = nextProps\n    // Once routes are available, map them to the route options format.\n    if (routes && !this.props.routes) {\n      const routeOptions = Object.values(routes).map(this.routeToOption)\n      this.setState({routeOptions})\n    }\n  }\n\n  _setPreferredRoutes = options => {\n    const preferredRoutes = options ? options.map(o => (o.value)).join(',') : ''\n    this.props.setQueryParam({ preferredRoutes })\n  }\n\n  _isBannedRouteOptionDisabled = option => {\n    // Disable routes that are preferred already.\n    const preferredRoutes = this.getRouteList('preferredRoutes')\n    return preferredRoutes && preferredRoutes.find(o => o.value === option.value)\n  }\n\n  _isPreferredRouteOptionDisabled = option => {\n    // Disable routes that are banned already.\n    const bannedRoutes = this.getRouteList('bannedRoutes')\n    return bannedRoutes && bannedRoutes.find(o => o.value === option.value)\n  }\n\n  getDistanceStep = distanceInMeters => {\n    // Determine step for max walk/bike based on current value. Increment by a\n    // quarter mile if dealing with small values, whatever number will round off\n    // the number if it is not an integer, or default to one mile.\n    return metersToMiles(distanceInMeters) <= 2\n      ? '.25'\n      : metersToMiles(distanceInMeters) % 1 !== 0\n        ? `${metersToMiles(distanceInMeters) % 1}`\n        : '1'\n  }\n\n  _onSubModeChange = changedMode => {\n    // Get previous transit modes from state and all modes from query.\n    const transitModes = [...this.state.transitModes]\n    const allModes = this.props.currentQuery.mode.split(',')\n    const index = transitModes.indexOf(changedMode)\n    if (index === -1) {\n      // If submode was not selected, add it.\n      transitModes.push(changedMode)\n      allModes.push(changedMode)\n    } else {\n      // Otherwise, remove it.\n      transitModes.splice(index, 1)\n      const i = allModes.indexOf(changedMode)\n      allModes.splice(i, 1)\n    }\n    // Update transit modes in state.\n    this.setState({transitModes})\n    // Update all modes in query (set to walk if all transit modes inactive).\n    this.props.setQueryParam({ mode: allModes.join(',') || 'WALK' })\n  }\n\n  _setMaxWalkDistance = evt => {\n    this.props.setQueryParam({ maxWalkDistance: milesToMeters(evt.target.value) })\n  }\n\n  /**\n   * Get list of routes for specified key (either 'bannedRoutes' or\n   * 'preferredRoutes').\n   */\n  getRouteList = key => {\n    const routesParam = this.props.currentQuery[key]\n    const idList = routesParam ? routesParam.split(',') : []\n    if (this.state.routeOptions) {\n      return this.state.routeOptions.filter(o => idList.indexOf(o.value) !== -1)\n    } else {\n      // If route list is not available, default labels to route IDs.\n      return idList.map(id => ({value: id, label: id}))\n    }\n  }\n\n  routeToOption = route => {\n    if (!route) return null\n    const {id, longName, shortName} = route\n    // For some reason the OTP API expects route IDs in this double\n    // underscore format\n    // FIXME: This replace is flimsy! What if there are more colons?\n    const value = id.replace(':', '__')\n    const label = shortName\n      ? `${shortName}${longName ? ` - ${longName}` : ''}`\n      : longName\n    return {value, label}\n  }\n\n  render () {\n    const {currentQuery, modes, ModeIcon} = this.props\n    const {maxBikeDistance, maxWalkDistance, mode} = currentQuery\n    const bannedRoutes = this.getRouteList('bannedRoutes')\n    const preferredRoutes = this.getRouteList('preferredRoutes')\n    const transitModes = modes.transitModes.map(modeObj => {\n      const modeStr = modeObj.mode || modeObj\n      return {\n        id: modeStr,\n        selected: this.state.transitModes.indexOf(modeStr) !== -1,\n        text: (\n          <span>\n            <ModeIcon mode={modeStr} />\n          </span>\n        ),\n        title: modeObj.label\n      }\n    })\n    // FIXME: Set units via config.\n    const unitsString = '(mi.)'\n    return (\n      <div>\n        <div style={{alignItems: 'center', display: 'flex', justifyContent: 'space-between'}}>\n          <label style={{fontWeight: '400'}}>\n            Max walk {unitsString}\n            <input\n              onChange={this._setMaxWalkDistance}\n              onKeyDown={this._handleFormKeyDown}\n              step={this.getDistanceStep(maxWalkDistance)}\n              min='0'\n              style={{display: 'block', marginRight: '10px', width: '60px'}}\n              value={metersToMiles(maxWalkDistance)}\n              type='number' />\n          </label>\n          {hasBike(mode)\n            ? <label style={{fontWeight: '400'}}>\n              Max bike {unitsString}\n              <input\n                onChange={this._setMaxBikeDistance}\n                onKeyDown={this._handleFormKeyDown}\n                step={this.getDistanceStep(maxBikeDistance)}\n                min='0'\n                style={{display: 'block', marginRight: '10px', width: '60px'}}\n                value={metersToMiles(maxBikeDistance)}\n                type='number' />\n            </label>\n            : null\n          }\n          <StyledSubmodeSelector\n            modes={transitModes}\n            onChange={this._onSubModeChange}\n            // FIXME: Need to pass onKeyDown to children buttons in\n            // otp-ui.\n            onKeyDown={this._handleFormKeyDown}\n          />\n        </div>\n        <Select\n          value={preferredRoutes}\n          id='preferredRoutes'\n          isMulti\n          isOptionDisabled={this._isPreferredRouteOptionDisabled}\n          options={this.state.routeOptions}\n          onChange={this._setPreferredRoutes}\n          placeholder='Select preferred routes...' />\n        <Select\n          value={bannedRoutes}\n          id='bannedRoutes'\n          isMulti\n          isOptionDisabled={this._isBannedRouteOptionDisabled}\n          options={this.state.routeOptions}\n          onChange={this._setBannedRoutes}\n          placeholder='Select banned routes...' />\n      </div>\n    )\n  }\n}\n\nconst TIME_FORMATS = [\n  'HH:mm:ss',\n  'h:mm:ss a',\n  'h:mm:ssa',\n  'h:mm a',\n  'h:mma',\n  'h:mm',\n  'HHmm',\n  'hmm',\n  'ha',\n  'h',\n  'HH:mm'\n].map(format => `YYYY-MM-DDT${format}`)\n\nclass DateTimeOptions extends Component {\n  _setDepartArrive = evt => {\n    const {value: departArrive} = evt.target\n    if (departArrive === 'NOW') {\n      this.props.setQueryParam({\n        departArrive,\n        date: moment().format(OTP_API_DATE_FORMAT),\n        time: moment().format(OTP_API_TIME_FORMAT)\n      })\n    } else {\n      this.props.setQueryParam({ departArrive })\n    }\n  }\n\n  handleDateChange = evt => {\n    this.props.setQueryParam({ date: evt.target.value })\n  }\n\n  handleTimeChange = evt => {\n    const timeInput = evt.target.value\n    console.log(timeInput)\n    const date = moment().startOf('day').format('YYYY-MM-DD')\n    const time = moment(date + 'T' + timeInput, TIME_FORMATS)\n    this.props.setQueryParam({ time: time.format(OTP_API_TIME_FORMAT) })\n  }\n\n  render () {\n    const {date, departArrive, time} = this.props\n    const leaveNow = departArrive === 'NOW' && !date && !time\n    const dateTime = moment(`${date} ${time}`)\n    const cleanDate = dateTime.format('YYYY-MM-DD')\n    const cleanTime = dateTime.format('HH:mm')\n    return (\n      <>\n        <select\n          onBlur={this._setDepartArrive}\n          onKeyDown={this.props.onKeyDown}\n          value={departArrive}\n          onChange={this._setDepartArrive}>\n          {departureOptions.map(o => (\n            <option key={o.value} {...o} />\n          ))}\n        </select>\n        {leaveNow\n          ? null\n          : <span style={{\n            display: 'inline-flex'\n          }}>\n            <span>{cleanTime}</span>\n            <input\n              style={{width: '50px'}}\n              onKeyDown={this.props.onKeyDown}\n              required\n              onChange={this.handleTimeChange}\n            />\n          </span>\n        }\n        {leaveNow\n          ? null\n          : <input\n            onKeyDown={this.props.onKeyDown}\n            type='date'\n            value={cleanDate}\n            style={{\n              position: 'absolute',\n              left: '180px',\n              width: '124px',\n              border: 'none',\n              outline: 'none'\n            }}\n            required\n            onChange={this.handleDateChange}\n          />\n        }\n      </>\n    )\n  }\n}\n\n// connect to the redux store\nconst mapStateToProps = (state, ownProps) => {\n  const showUserSettings = getShowUserSettings(state.otp)\n  return {\n    activeSearch: getActiveSearch(state.otp),\n    currentQuery: state.otp.currentQuery,\n    expandAdvanced: state.otp.user.expandAdvanced,\n    mainPanelContent: state.otp.ui.mainPanelContent,\n    modes: state.otp.config.modes,\n    routes: state.otp.transitIndex.routes,\n    showUserSettings\n  }\n}\n\nconst mapDispatchToProps = {\n  findRoutes: apiActions.findRoutes,\n  routingQuery: apiActions.routingQuery,\n  setQueryParam: formActions.setQueryParam\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(CallTakerPanel)\n"]}
