{"version":3,"sources":["responsive-webapp.js"],"names":["isMobile","coreUtils","ui","ResponsiveWebapp","prevProps","props","currentPosition","location","query","title","document","urlParams","getUrlParams","newSearchId","ui_activeSearch","replanningTrip","activeSearchId","formChanged","error","coords","pt","lat","latitude","lon","longitude","from","setLocationToCurrent","locationType","setMapCenter","initZoomOnLocate","setMapZoom","zoom","pathname","matchContentToUrl","window","addEventListener","handleBackButtonPress","getCurrentPosition","navigator","geolocation","watchPosition","position","receivedPositionResponse","console","log","enableHighAccuracy","search","parseUrlQueryString","initializeModules","removeEventListener","desktopView","mobileView","Component","PropTypes","element","number","object","mapStateToProps","state","ownProps","activeItinerary","otp","currentQuery","searches","mobileScreen","config","map","modeGroups","mapDispatchToProps","formActions","locationActions","uiActions","callTakerActions","mapActions","configActions","history","WebappWithRouter","RouterWrapperWithAuth0","routerProps","auth0Config","processSignIn","routerConfig","showAccessTokenError","showLoginError","router","basename","_combineProps","SavedTripList","AUTH0_AUDIENCE","clientId","domain","BeforeSignInScreen","URL_ROOT","AUTH0_SCOPE","mapStateToWrapperProps","persistence","reactRouter","mapWrapperDispatchToProps","authActions"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AAEA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAEQA,Q,GAAaC,mBAAUC,E,CAAvBF,Q;;IAEFG,gB;;;;;;;;;;;;;;AAQJ;uCAEoBC,S,EAAW;AAAA,wBACuB,KAAKC,KAD5B;AAAA,UACrBC,eADqB,eACrBA,eADqB;AAAA,UACJC,QADI,eACJA,QADI;AAAA,UACMC,KADN,eACMA,KADN;AAAA,UACaC,KADb,eACaA,KADb;AAE7BC,MAAAA,QAAQ,CAACD,KAAT,GAAiBA,KAAjB;;AACA,UAAME,SAAS,GAAGV,mBAAUO,KAAV,CAAgBI,YAAhB,EAAlB;;AACA,UAAMC,WAAW,GAAGF,SAAS,CAACG,eAA9B,CAJ6B,CAK7B;AACA;AACA;AACA;AACA;;AACA,UAAMC,cAAc,GAAGF,WAAW,IAAI,KAAKR,KAAL,CAAWW,cAA1B,IAA4CH,WAAW,KAAK,KAAKR,KAAL,CAAWW,cAA9F;;AACA,UAAI,CAAC,qBAAQZ,SAAS,CAACI,KAAlB,EAAyBA,KAAzB,CAAD,IAAoC,CAACO,cAAzC,EAAyD;AACvD;AACA;AACA;AACA;AACA,aAAKV,KAAL,CAAWY,WAAX,CAAuBb,SAAS,CAACI,KAAjC,EAAwCA,KAAxC;AACD,OAjB4B,CAmB7B;;;AACA,UAAIF,eAAe,KAAKF,SAAS,CAACE,eAAlC,EAAmD;AACjD,YAAIA,eAAe,CAACY,KAAhB,IAAyB,CAACZ,eAAe,CAACa,MAA9C,EAAsD;AACtD,YAAMC,EAAE,GAAG;AACTC,UAAAA,GAAG,EAAEf,eAAe,CAACa,MAAhB,CAAuBG,QADnB;AAETC,UAAAA,GAAG,EAAEjB,eAAe,CAACa,MAAhB,CAAuBK;AAFnB,SAAX,CAFiD,CAOjD;;AACA,YAAIxB,QAAQ,MAAM,KAAKK,KAAL,CAAWG,KAAX,CAAiBiB,IAAjB,KAA0B,IAA5C,EAAkD;AAChD,eAAKpB,KAAL,CAAWqB,oBAAX,CAAgC;AAAEC,YAAAA,YAAY,EAAE;AAAhB,WAAhC;AACA,eAAKtB,KAAL,CAAWuB,YAAX,CAAwBR,EAAxB;;AACA,cAAI,KAAKf,KAAL,CAAWwB,gBAAf,EAAiC;AAC/B,iBAAKxB,KAAL,CAAWyB,UAAX,CAAsB;AAAEC,cAAAA,IAAI,EAAE,KAAK1B,KAAL,CAAWwB;AAAnB,aAAtB;AACD;AACF;AACF,OAnC4B,CAoC7B;AACA;;;AACA,UAAI,CAAC,qBAAQtB,QAAQ,CAACyB,QAAjB,EAA2B5B,SAAS,CAACG,QAAV,CAAmByB,QAA9C,CAAL,EAA8D;AAC5D;AACA,aAAK3B,KAAL,CAAW4B,iBAAX,CAA6B1B,QAA7B;AACD,OAzC4B,CA0C7B;AACA;;AACA;;;;;;;;;;;;;;;AAcD;;;wCAEoB;AAAA;;AACnB;AACA2B,MAAAA,MAAM,CAACC,gBAAP,CAAwB,UAAxB,EAAoC,KAAK9B,KAAL,CAAW+B,qBAA/C;AAFmB,yBAGS,KAAK/B,KAHd;AAAA,UAGXE,QAHW,gBAGXA,QAHW;AAAA,UAGDE,KAHC,gBAGDA,KAHC;AAInBC,MAAAA,QAAQ,CAACD,KAAT,GAAiBA,KAAjB;;AACA,UAAIT,QAAQ,EAAZ,EAAgB;AACd;AACA,aAAKK,KAAL,CAAWgC,kBAAX,GAFc,CAId;;AACAC,QAAAA,SAAS,CAACC,WAAV,CAAsBC,aAAtB,EACE;AACA,kBAAAC,QAAQ,EAAI;AAAE,UAAA,KAAI,CAACpC,KAAL,CAAWqC,wBAAX,CAAoC;AAAED,YAAAA,QAAQ,EAARA;AAAF,WAApC;AAAmD,SAFnE,EAGE;AACA,kBAAAvB,KAAK,EAAI;AAAEyB,UAAAA,OAAO,CAACC,GAAR,CAAY,wBAAZ,EAAsC1B,KAAtC;AAA8C,SAJ3D,EAKE;AACA;AAAE2B,UAAAA,kBAAkB,EAAE;AAAtB,SANF;AAQD,OAlBkB,CAmBnB;AACA;AACA;;;AACA,WAAKxC,KAAL,CAAW4B,iBAAX,CAA6B,KAAK5B,KAAL,CAAWE,QAAxC;;AACA,UAAIA,QAAQ,IAAIA,QAAQ,CAACuC,MAAzB,EAAiC;AAC/B;AACA;AACA,aAAKzC,KAAL,CAAW0C,mBAAX;AACD,OA3BkB,CA4BnB;;;AACA,WAAK1C,KAAL,CAAW2C,iBAAX;AACD;;;2CAEuB;AACtB;AACAd,MAAAA,MAAM,CAACe,mBAAP,CAA2B,UAA3B,EAAuC,KAAK5C,KAAL,CAAW+B,qBAAlD;AACD;;;6BAES;AAAA,yBAC4B,KAAK/B,KADjC;AAAA,UACA6C,WADA,gBACAA,WADA;AAAA,UACaC,UADb,gBACaA,UADb;AAER,aAAOnD,QAAQ,KAAKmD,UAAL,GAAkBD,WAAjC;AACD;;;;EA9G4BE,gB,GAiH/B;;;gBAjHMjD,gB,eACe;AACjB+C,EAAAA,WAAW,EAAEG,mBAAUC,OADN;AAEjBzB,EAAAA,gBAAgB,EAAEwB,mBAAUE,MAFX;AAGjBJ,EAAAA,UAAU,EAAEE,mBAAUC,OAHL;AAIjB9C,EAAAA,KAAK,EAAE6C,mBAAUG;AAJA,C;;AAkHrB,IAAMC,eAAe,GAAG,SAAlBA,eAAkB,CAACC,KAAD,EAAQC,QAAR,EAAqB;AAC3C,MAAMlD,KAAK,GAAG,qBAASiD,KAAT,CAAd;AACA,SAAO;AACLE,IAAAA,eAAe,EAAE,+BAAmBF,KAAK,CAACG,GAAzB,CADZ;AAEL7C,IAAAA,cAAc,EAAE0C,KAAK,CAACG,GAAN,CAAU7C,cAFrB;AAGLV,IAAAA,eAAe,EAAEoD,KAAK,CAACG,GAAN,CAAUtD,QAAV,CAAmBD,eAH/B;AAILE,IAAAA,KAAK,EAAEkD,KAAK,CAACG,GAAN,CAAUC,YAJZ;AAKLC,IAAAA,QAAQ,EAAEL,KAAK,CAACG,GAAN,CAAUE,QALf;AAMLC,IAAAA,YAAY,EAAEN,KAAK,CAACG,GAAN,CAAU3D,EAAV,CAAa8D,YANtB;AAOLnC,IAAAA,gBAAgB,EAAE6B,KAAK,CAACG,GAAN,CAAUI,MAAV,CAAiBC,GAAjB,IAAwBR,KAAK,CAACG,GAAN,CAAUI,MAAV,CAAiBC,GAAjB,CAAqBrC,gBAP1D;AAQLsC,IAAAA,UAAU,EAAET,KAAK,CAACG,GAAN,CAAUI,MAAV,CAAiBE,UARxB;AASL1D,IAAAA,KAAK,EAALA;AATK,GAAP;AAWD,CAbD;;AAeA,IAAM2D,kBAAkB,GAAG;AACzBnD,EAAAA,WAAW,EAAEoD,WAAW,CAACpD,WADA;AAEzBoB,EAAAA,kBAAkB,EAAEiC,eAAe,CAACjC,kBAFX;AAGzBD,EAAAA,qBAAqB,EAAEmC,SAAS,CAACnC,qBAHR;AAIzBY,EAAAA,iBAAiB,EAAEwB,gBAAgB,CAACxB,iBAJX;AAKzBf,EAAAA,iBAAiB,EAAEsC,SAAS,CAACtC,iBALJ;AAMzBc,EAAAA,mBAAmB,EAAEsB,WAAW,CAACtB,mBANR;AAOzBL,EAAAA,wBAAwB,EAAE4B,eAAe,CAAC5B,wBAPjB;AAQzBhB,EAAAA,oBAAoB,EAAE+C,UAAU,CAAC/C,oBARR;AASzBE,EAAAA,YAAY,EAAE8C,aAAa,CAAC9C,YATH;AAUzBE,EAAAA,UAAU,EAAE4C,aAAa,CAAC5C;AAVD,CAA3B;AAaA,IAAM6C,OAAO,GAAG,iCAAhB;AAEA,IAAMC,gBAAgB,GAAG,6BACvB,sCACE,yBAAQnB,eAAR,EAAyBW,kBAAzB,EAA6CjE,gBAA7C,CADF,CADuB,CAAzB;AAMA;;;;;;;IAMM0E,sB;;;;;;;;;;;;;;;;qEAOY,UAAAC,WAAW,EAAI;AAC7B,6CAAY,OAAKzE,KAAjB,GAA2ByE,WAA3B;AACD,K;;;;;;;6BAES;AAAA;;AAAA,yBAOJ,KAAKzE,KAPD;AAAA,UAEN0E,WAFM,gBAENA,WAFM;AAAA,UAGNC,aAHM,gBAGNA,aAHM;AAAA,UAINC,YAJM,gBAINA,YAJM;AAAA,UAKNC,oBALM,gBAKNA,oBALM;AAAA,UAMNC,cANM,gBAMNA,cANM;;AASR,UAAMC,MAAM,gBACV,6BAAC,qCAAD;AACE,QAAA,QAAQ,EAAEH,YAAY,IAAIA,YAAY,CAACI,QADzC;AAEE,QAAA,OAAO,EAAEV;AAFX,sBAGE,uDACE,6BAAC,mBAAD,qBACE,6BAAC,kBAAD;AACE,QAAA,KAAK,MADP;AAEE,QAAA,IAAI,EAAE,CACJ;AACA,WAFI,EAGJ;AACA;AACA;AACA;AACA,8BAPI,EAQJ,0BARI,EASJ;AACA,gBAVI,EAWJ,YAXI,EAYJ;AACA,eAbI,EAcJ,WAdI,CAFR;AAkBE,QAAA,MAAM,EAAE;AAAA,8BAAM,6BAAC,gBAAD,EAAsB,MAAI,CAACtE,KAA3B,CAAN;AAAA;AAlBV,QADF,eAqBE,6BAAC,kBAAD,CACE;AADF;AAEE,QAAA,IAAI,EAAE,UAFR;AAGE,QAAA,SAAS,EAAE,mBAAAyE,WAAW,EAAI;AACxB,cAAMzE,KAAK,GAAG,MAAI,CAACiF,aAAL,CAAmBR,WAAnB,CAAd;;AACA,8BAAO,6BAAC,0BAAD,EAAuBzE,KAAvB,CAAP;AACD;AANH,QArBF,eA6BE,6BAAC,kBAAD;AACE,QAAA,IAAI,EAAE,WADR;AAEE,QAAA,SAAS,EAAE,mBAACyE,WAAD,EAAiB;AAC1B,cAAMzE,KAAK,GAAG,MAAI,CAACiF,aAAL,CAAmBR,WAAnB,CAAd;;AACA,8BAAO,6BAAC,wBAAD;AAAiB,YAAA,UAAU;AAA3B,aAAgCzE,KAAhC,EAAP;AACD;AALH,QA7BF,eAoCE,6BAAC,kBAAD;AACE,QAAA,IAAI,EAAE,iBADR;AAEE,QAAA,SAAS,EAAE,mBAACyE,WAAD,EAAiB;AAC1B,cAAMzE,KAAK,GAAG,MAAI,CAACiF,aAAL,CAAmBR,WAAnB,CAAd;;AACA,8BAAO,6BAAC,wBAAD,EAAqBzE,KAArB,CAAP;AACD;AALH,QApCF,eA2CE,6BAAC,kBAAD;AACE,QAAA,IAAI,EAAE,aADR;AAEE,QAAA,SAAS,EAAEkF;AAFb,QA3CF,eA+CE,6BAAC,kBAAD,CACE;AACA;AACA;AACA;AAJF;AAKE,QAAA,IAAI,EAAE,WALR;AAME,QAAA,SAAS,EAAE,mBAAAT,WAAW,EAAI;AACxB,cAAMzE,KAAK,GAAG,MAAI,CAACiF,aAAL,CAAmBR,WAAnB,CAAd;;AACA,8BAAO,6BAAC,0BAAD,EAAuBzE,KAAvB,CAAP;AACD;AATH,QA/CF,eA0DE,6BAAC,kBAAD;AACE,QAAA,IAAI,EAAC,QADP;AAEE,QAAA,SAAS,EAAE,mBAAAyE,WAAW,EAAI;AACxB,cAAMzE,KAAK,GAAG,MAAI,CAACiF,aAAL,CAAmBR,WAAnB,CAAd;;AACA,8BAAO,6BAAC,oBAAD,EAAiBzE,KAAjB,CAAP;AACD;AALH,QA1DF,eAkEE,6BAAC,kBAAD;AACE,QAAA,MAAM,EAAE;AAAA,8BAAM,6BAAC,gBAAD,EAAsB,MAAI,CAACA,KAA3B,CAAN;AAAA;AADV,QAlEF,CADF,CAHF,CADF;;AA+EA,aACE0E,WAAW,gBAEP,6BAAC,4BAAD;AACE,QAAA,QAAQ,EAAES,yBADZ;AAEE,QAAA,QAAQ,EAAET,WAAW,CAACU,QAFxB;AAGE,QAAA,MAAM,EAAEV,WAAW,CAACW,MAHtB;AAIE,QAAA,kBAAkB,EAAER,oBAJtB;AAKE,QAAA,YAAY,EAAEC,cALhB;AAME,QAAA,kBAAkB,EAAEH,aANtB;AAOE,QAAA,aAAa,EAAEW,2BAPjB;AAQE,QAAA,WAAW,EAAEC,mBARf;AASE,QAAA,KAAK,EAAEC;AATT,SAWGT,MAXH,CAFO,GAgBPA,MAjBN;AAmBD;;;;EAtHkChC,gB;;AAyHrC,IAAM0C,sBAAsB,GAAG,SAAzBA,sBAAyB,CAACpC,KAAD,EAAQC,QAAR;AAAA,SAAsB;AACnDoB,IAAAA,WAAW,EAAE,2BAAerB,KAAK,CAACG,GAAN,CAAUI,MAAV,CAAiB8B,WAAhC,CADsC;AAEnDd,IAAAA,YAAY,EAAEvB,KAAK,CAACG,GAAN,CAAUI,MAAV,CAAiB+B;AAFoB,GAAtB;AAAA,CAA/B;;AAKA,IAAMC,yBAAyB,GAAG;AAChCjB,EAAAA,aAAa,EAAEkB,WAAW,CAAClB,aADK;AAEhCE,EAAAA,oBAAoB,EAAEgB,WAAW,CAAChB,oBAFF;AAGhCC,EAAAA,cAAc,EAAEe,WAAW,CAACf;AAHI,CAAlC;;eAMe,yBAAQW,sBAAR,EAAgCG,yBAAhC,EAA2DpB,sBAA3D,C","sourcesContent":["import { ConnectedRouter } from 'connected-react-router'\nimport { createHashHistory } from 'history'\nimport isEqual from 'lodash.isequal'\nimport coreUtils from '@opentripplanner/core-utils'\nimport PropTypes from 'prop-types'\nimport React, { Component } from 'react'\nimport { connect } from 'react-redux'\nimport { Route, Switch, withRouter } from 'react-router'\nimport { Auth0Provider } from 'use-auth0-hooks'\n\nimport PrintLayout from './print-layout'\nimport * as authActions from '../../actions/auth'\nimport * as callTakerActions from '../../actions/call-taker'\nimport * as configActions from '../../actions/config'\nimport * as formActions from '../../actions/form'\nimport * as locationActions from '../../actions/location'\nimport * as mapActions from '../../actions/map'\nimport * as uiActions from '../../actions/ui'\nimport { getAuth0Config } from '../../util/auth'\nimport { AUTH0_AUDIENCE, AUTH0_SCOPE, URL_ROOT } from '../../util/constants'\nimport { getActiveItinerary, getTitle } from '../../util/state'\nimport AfterSignInScreen from '../user/after-signin-screen'\nimport BeforeSignInScreen from '../user/before-signin-screen'\nimport SavedTripList from '../user/saved-trip-list'\nimport SavedTripScreen from '../user/saved-trip-screen'\nimport UserAccountScreen from '../user/user-account-screen'\nimport withLoggedInUserSupport from '../user/with-logged-in-user-support'\n\nconst { isMobile } = coreUtils.ui\n\nclass ResponsiveWebapp extends Component {\n  static propTypes = {\n    desktopView: PropTypes.element,\n    initZoomOnLocate: PropTypes.number,\n    mobileView: PropTypes.element,\n    query: PropTypes.object\n  }\n\n  /** Lifecycle methods **/\n\n  componentDidUpdate (prevProps) {\n    const { currentPosition, location, query, title } = this.props\n    document.title = title\n    const urlParams = coreUtils.query.getUrlParams()\n    const newSearchId = urlParams.ui_activeSearch\n    // Determine if trip is being replanned by checking the active search ID\n    // against the ID found in the URL params. If they are different, a new one\n    // has been routed to (see handleBackButtonPress) and there is no need to\n    // trigger a form change because necessarily the query will be different\n    // from the previous query.\n    const replanningTrip = newSearchId && this.props.activeSearchId && newSearchId !== this.props.activeSearchId\n    if (!isEqual(prevProps.query, query) && !replanningTrip) {\n      // Trigger on form change action if previous query is different from\n      // current one AND trip is not being replanned already. This will\n      // determine whether a search needs to be made, the mobile view needs\n      // updating, etc.\n      this.props.formChanged(prevProps.query, query)\n    }\n\n    // check if device position changed (typically only set once, on initial page load)\n    if (currentPosition !== prevProps.currentPosition) {\n      if (currentPosition.error || !currentPosition.coords) return\n      const pt = {\n        lat: currentPosition.coords.latitude,\n        lon: currentPosition.coords.longitude\n      }\n\n      // if in mobile mode and from field is not set, use current location as from and recenter map\n      if (isMobile() && this.props.query.from === null) {\n        this.props.setLocationToCurrent({ locationType: 'from' })\n        this.props.setMapCenter(pt)\n        if (this.props.initZoomOnLocate) {\n          this.props.setMapZoom({ zoom: this.props.initZoomOnLocate })\n        }\n      }\n    }\n    // If the path changes (e.g., via a back button press) check whether the\n    // main content needs to switch between, for example, a viewer and a search.\n    if (!isEqual(location.pathname, prevProps.location.pathname)) {\n      // console.log('url changed to', location.pathname)\n      this.props.matchContentToUrl(location)\n    }\n    // Check for change between ITINERARY and PROFILE routingTypes\n    // TODO: restore this for profile mode\n    /* if (query.routingType !== nextProps.query.routingType) {\n      let queryModes = nextProps.query.mode.split(',')\n      // If we are entering 'ITINERARY' mode, ensure that one and only one access mode is selected\n      if (nextProps.query.routingType === 'ITINERARY') {\n        queryModes = ensureSingleAccessMode(queryModes)\n        this.props.setQueryParam({ mode: queryModes.join(',') })\n      }\n      // If we are entering 'PROFILE' mode, ensure that CAR_HAIL is not selected\n      // TODO: make this more generic, i.e. introduce concept of mode->routingType permissions\n      if (nextProps.query.routingType === 'ITINERARY') {\n        queryModes = queryModes.filter(mode => mode !== 'CAR_HAIL')\n        this.props.setQueryParam({ mode: queryModes.join(',') })\n      }\n    } */\n  }\n\n  componentDidMount () {\n    // Add on back button press behavior.\n    window.addEventListener('popstate', this.props.handleBackButtonPress)\n    const { location, title } = this.props\n    document.title = title\n    if (isMobile()) {\n      // If on mobile browser, check position on load\n      this.props.getCurrentPosition()\n\n      // Also, watch for changes in position on mobile\n      navigator.geolocation.watchPosition(\n        // On success\n        position => { this.props.receivedPositionResponse({ position }) },\n        // On error\n        error => { console.log('error in watchPosition', error) },\n        // Options\n        { enableHighAccuracy: true }\n      )\n    }\n    // Handle routing to a specific part of the app (e.g. stop viewer) on page\n    // load. (This happens prior to routing request in case special routerId is\n    // set from URL.)\n    this.props.matchContentToUrl(this.props.location)\n    if (location && location.search) {\n      // Set search params and Pianifica Viaggio if routing enabled and a query exists\n      // in the URL.\n      this.props.parseUrlQueryString()\n    }\n    // Initialize call taker/field trip modules (check for valid auth session).\n    this.props.initializeModules()\n  }\n\n  componentWillUnmount () {\n    // Remove on back button press listener.\n    window.removeEventListener('popstate', this.props.handleBackButtonPress)\n  }\n\n  render () {\n    const { desktopView, mobileView } = this.props\n    return isMobile() ? mobileView : desktopView\n  }\n}\n\n// connect to the redux store\n\nconst mapStateToProps = (state, ownProps) => {\n  const title = getTitle(state)\n  return {\n    activeItinerary: getActiveItinerary(state.otp),\n    activeSearchId: state.otp.activeSearchId,\n    currentPosition: state.otp.location.currentPosition,\n    query: state.otp.currentQuery,\n    searches: state.otp.searches,\n    mobileScreen: state.otp.ui.mobileScreen,\n    initZoomOnLocate: state.otp.config.map && state.otp.config.map.initZoomOnLocate,\n    modeGroups: state.otp.config.modeGroups,\n    title\n  }\n}\n\nconst mapDispatchToProps = {\n  formChanged: formActions.formChanged,\n  getCurrentPosition: locationActions.getCurrentPosition,\n  handleBackButtonPress: uiActions.handleBackButtonPress,\n  initializeModules: callTakerActions.initializeModules,\n  matchContentToUrl: uiActions.matchContentToUrl,\n  parseUrlQueryString: formActions.parseUrlQueryString,\n  receivedPositionResponse: locationActions.receivedPositionResponse,\n  setLocationToCurrent: mapActions.setLocationToCurrent,\n  setMapCenter: configActions.setMapCenter,\n  setMapZoom: configActions.setMapZoom\n}\n\nconst history = createHashHistory()\n\nconst WebappWithRouter = withRouter(\n  withLoggedInUserSupport(\n    connect(mapStateToProps, mapDispatchToProps)(ResponsiveWebapp)\n  )\n)\n\n/**\n * The routing component for the application.\n * This is the top-most \"standard\" component,\n * and we initialize the Auth0Provider here\n * so that Auth0 services are available everywhere.\n */\nclass RouterWrapperWithAuth0 extends Component {\n  /**\n   * Combine the router props with the other props that get\n   * passed to the exported component. This way, it is possible for\n   * the PrintLayout, UserAccountScreen, and other components to\n   * receive the LegIcon or other needed props.\n   */\n  _combineProps = routerProps => {\n    return { ...this.props, ...routerProps }\n  }\n\n  render () {\n    const {\n      auth0Config,\n      processSignIn,\n      routerConfig,\n      showAccessTokenError,\n      showLoginError\n    } = this.props\n\n    const router = (\n      <ConnectedRouter\n        basename={routerConfig && routerConfig.basename}\n        history={history}>\n        <div>\n          <Switch>\n            <Route\n              exact\n              path={[\n                // App root\n                '/',\n                // Load app with preset lat/lon/zoom and optional router\n                // NOTE: All params will be cast to :id in matchContentToUrl due\n                // to a quirk with react-router.\n                // https://github.com/ReactTraining/react-router/issues/5870#issuecomment-394194338\n                '/@/:latLonZoomRouter',\n                '/start/:latLonZoomRouter',\n                // Route viewer (and route ID).\n                '/route',\n                '/route/:id',\n                // Stop viewer (and stop ID).\n                '/stop',\n                '/stop/:id'\n              ]}\n              render={() => <WebappWithRouter {...this.props} />}\n            />\n            <Route\n              // This route lets new or existing users edit or set up their account.\n              path={'/account'}\n              component={routerProps => {\n                const props = this._combineProps(routerProps)\n                return <UserAccountScreen {...props} />\n              }}\n            />\n            <Route\n              path={'/savetrip'}\n              component={(routerProps) => {\n                const props = this._combineProps(routerProps)\n                return <SavedTripScreen isCreating {...props} />\n              }}\n            />\n            <Route\n              path={'/savedtrips/:id'}\n              component={(routerProps) => {\n                const props = this._combineProps(routerProps)\n                return <SavedTripScreen {...props} />\n              }}\n            />\n            <Route\n              path={'/savedtrips'}\n              component={SavedTripList}\n            />\n            <Route\n              // This route is called immediately after login by Auth0\n              // and by the onRedirectCallback function from /lib/util/auth.js.\n              // For new users, it displays the account setup form.\n              // For existing users, it takes the browser back to the itinerary search prior to login.\n              path={'/signedin'}\n              component={routerProps => {\n                const props = this._combineProps(routerProps)\n                return <AfterSignInScreen {...props} />\n              }}\n            />\n            <Route\n              path='/print'\n              component={routerProps => {\n                const props = this._combineProps(routerProps)\n                return <PrintLayout {...props} />\n              }}\n            />\n            {/* For any other route, simply return the web app. */}\n            <Route\n              render={() => <WebappWithRouter {...this.props} />}\n            />\n          </Switch>\n        </div>\n      </ConnectedRouter>\n    )\n\n    return (\n      auth0Config\n        ? (\n          <Auth0Provider\n            audience={AUTH0_AUDIENCE}\n            clientId={auth0Config.clientId}\n            domain={auth0Config.domain}\n            onAccessTokenError={showAccessTokenError}\n            onLoginError={showLoginError}\n            onRedirectCallback={processSignIn}\n            onRedirecting={BeforeSignInScreen}\n            redirectUri={URL_ROOT}\n            scope={AUTH0_SCOPE}\n          >\n            {router}\n          </Auth0Provider>\n        )\n        : router\n    )\n  }\n}\n\nconst mapStateToWrapperProps = (state, ownProps) => ({\n  auth0Config: getAuth0Config(state.otp.config.persistence),\n  routerConfig: state.otp.config.reactRouter\n})\n\nconst mapWrapperDispatchToProps = {\n  processSignIn: authActions.processSignIn,\n  showAccessTokenError: authActions.showAccessTokenError,\n  showLoginError: authActions.showLoginError\n}\n\nexport default connect(mapStateToWrapperProps, mapWrapperDispatchToProps)(RouterWrapperWithAuth0)\n"]}