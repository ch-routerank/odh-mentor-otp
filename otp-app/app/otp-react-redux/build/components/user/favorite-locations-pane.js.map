{"version":3,"sources":["favorite-locations-pane.js"],"names":["fancyAddLocationCss","StyledAddon","InputGroup","Addon","NewLocationAddon","NewLocationFormControl","FormControl","isHome","loc","type","isWork","notHomeOrWork","FavoriteLocationsPane","e","value","target","trim","length","props","userData","onUserDataChange","savedLocations","newLocations","push","address","icon","location","isValueEmpty","nonEmptyLocation","homeLocation","find","workLocation","concat","filter","effectiveLocations","map","index","_handleAddressChange","_handleAddNewLocation","Component","PropTypes","func","isRequired","object"],"mappings":"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","sourcesContent":["import clone from 'lodash/cloneDeep'\nimport memoize from 'lodash.memoize'\nimport PropTypes from 'prop-types'\nimport React, { Component } from 'react'\nimport {\n  ControlLabel,\n  FormControl,\n  FormGroup,\n  InputGroup\n} from 'react-bootstrap'\nimport FontAwesome from 'react-fontawesome'\nimport styled from 'styled-components'\n\n// Styles.\nconst fancyAddLocationCss = `\n  background-color: #337ab7;\n  color: #fff;\n`\nconst StyledAddon = styled(InputGroup.Addon)`\n  min-width: 40px;\n`\nconst NewLocationAddon = styled(StyledAddon)`\n  ${fancyAddLocationCss}\n`\nconst NewLocationFormControl = styled(FormControl)`\n  ${fancyAddLocationCss}\n  ::placeholder {\n    color: #fff;\n  }\n  &:focus {\n    background-color: unset;\n    color: unset;\n    ::placeholder {\n      color: unset;\n    }\n  }\n`\n\n// Helper filter functions.\nconst isHome = loc => loc.type === 'home'\nconst isWork = loc => loc.type === 'work'\nconst notHomeOrWork = loc => loc.type !== 'home' && loc.type !== 'work'\n\n/**\n * User's saved locations editor.\n */\nclass FavoriteLocationsPane extends Component {\n  static propTypes = {\n    onUserDataChange: PropTypes.func.isRequired,\n    userData: PropTypes.object.isRequired\n  }\n\n  _handleAddNewLocation = e => {\n    const value = e.target.value || ''\n    if (value.trim().length > 0) {\n      const { userData, onUserDataChange } = this.props\n      // FIXME: remove assigning [] when null.\n      const { savedLocations = [] } = userData\n\n      // Create a copy of savedLocations and add the new location to the copied array.\n      const newLocations = clone(savedLocations)\n      newLocations.push({\n        address: value.trim(),\n        icon: 'map-marker',\n        type: 'custom'\n      })\n\n      // Event onChange will trigger after this and before rerender,\n      // so DO empty the input box value so the user can enter their next location.\n      e.target.value = null\n\n      onUserDataChange({ savedLocations: newLocations })\n    }\n  }\n\n  _handleAddressChange = memoize(\n    location => e => {\n      const { userData, onUserDataChange } = this.props\n      // FIXME: remove assigning [] when null.\n      const { savedLocations = [] } = userData\n      const value = e.target.value\n      const isValueEmpty = !value || value === ''\n      const nonEmptyLocation = isValueEmpty ? null : location\n\n      // Update location address, ohterwise it stalls the input box.\n      location.address = value\n\n      // Create a new array for savedLocations.\n      let newLocations = []\n\n      // Add home/work as first entries to the new state only if\n      // - user edited home/work to non-empty, or\n      // - user edited another location and home/work is in savedLocations.\n      const homeLocation = (isHome(location) && nonEmptyLocation) || savedLocations.find(isHome)\n      if (homeLocation) newLocations.push(homeLocation)\n\n      const workLocation = (isWork(location) && nonEmptyLocation) || savedLocations.find(isWork)\n      if (workLocation) newLocations.push(workLocation)\n\n      // Add the rest if it is not home or work\n      // and if the new address of this one is not null or empty.\n      newLocations = newLocations.concat(savedLocations\n        .filter(notHomeOrWork)\n        .filter(loc => loc !== location || !isValueEmpty)\n      )\n\n      onUserDataChange({ savedLocations: newLocations })\n    }\n  )\n\n  render () {\n    const { userData } = this.props\n    // FIXME: remove assigning [] when null.\n    const { savedLocations = [] } = userData\n\n    // Build an 'effective' list of locations for display,\n    // where at least one 'home' and one 'work', are always present even if blank.\n    // In theory there could be multiple home or work locations.\n    // Just pick the first one.\n    const homeLocation = savedLocations.find(isHome) || {\n      address: null,\n      icon: 'home',\n      type: 'home'\n    }\n    const workLocation = savedLocations.find(isWork) || {\n      address: null,\n      icon: 'briefcase',\n      type: 'work'\n    }\n\n    const effectiveLocations = [\n      homeLocation,\n      workLocation,\n      ...savedLocations.filter(notHomeOrWork)\n    ]\n\n    return (\n      <div>\n        <ControlLabel>Add the places you frequent often to save time planning trips:</ControlLabel>\n\n        {effectiveLocations.map((loc, index) => (\n          <FormGroup key={index}>\n            <InputGroup>\n              <StyledAddon title={loc.type}>\n                <FontAwesome name={loc.icon} />\n              </StyledAddon>\n              <FormControl\n                onChange={this._handleAddressChange(loc)}\n                placeholder={`Add ${loc.type}`}\n                type='text'\n                value={loc.address} />\n            </InputGroup>\n          </FormGroup>\n        ))}\n\n        {/* For adding a location. */}\n        <FormGroup>\n          <InputGroup>\n            <NewLocationAddon>\n              <FontAwesome name='plus' />\n            </NewLocationAddon>\n            <NewLocationFormControl\n              onBlur={this._handleAddNewLocation}\n              placeholder='Add another place'\n              type='text'\n            />\n          </InputGroup>\n        </FormGroup>\n      </div>\n    )\n  }\n}\n\nexport default FavoriteLocationsPane\n"]}